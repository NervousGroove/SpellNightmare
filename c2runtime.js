var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,r){this.set(t,e,i,r),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return t>0&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return t>e?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return t>=0?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:e+1},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,r,s,n,a,o){var h,l,c,u,p,d,f,g;if(t<i?(l=t,h=i):(l=i,h=t),s<a?(d=s,p=a):(d=a,p=s),h<d||l>p)return!1;if(e<r?(u=e,c=r):(u=r,c=e),n<o?(g=n,f=o):(g=o,f=n),c<g||u>f)return!1;var _=s-t+a-i,y=n-e+o-r,m=i-t,v=r-e,w=a-s,b=o-n,x=cr.abs(v*w-b*m),S=w*y-b*_;if(cr.abs(S)>x)return!1;var T=m*y-v*_;return cr.abs(T)<=x},e.prototype.set=function(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){if(0===e)this.set_from_rect(t);else{var i=Math.sin(e),r=Math.cos(e),s=t.left*i,n=t.top*i,a=t.right*i,o=t.bottom*i,h=t.left*r,l=t.top*r,c=t.right*r,u=t.bottom*r;this.tlx=h-n,this.tly=l+s,this.trx=c-n,this.try_=l+a,this.brx=c-o,this.bry=u+a,this.blx=h-o,this.bly=u+s}},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var r=0,s=0;function n(t,e,i,n){t<e?i<n?(r=t<i?t:i,s=e>n?e:n):(r=t<n?t:n,s=e>i?e:i):i<n?(r=e<i?e:i,s=t>n?t:n):(r=e<n?e:n,s=t>i?t:i)}i.prototype.bounding_box=function(t){n(this.tlx,this.trx,this.brx,this.blx),t.left=r,t.right=s,n(this.tly,this.try_,this.bry,this.bly),t.top=r,t.bottom=s},i.prototype.contains_pt=function(t,e){var i,r,s,n=this.tlx,a=this.tly,o=this.trx-n,h=this.try_-a,l=this.brx-n,c=this.bry-a,u=t-n,p=e-a,d=l*l+c*c,f=l*u+c*p,g=1/((i=o*o+h*h)*d-(r=o*l+h*c)*r),_=(d*(s=o*u+h*p)-r*f)*g,y=(i*f-r*s)*g;return _>=0&&y>0&&_+y<1||(y=((i=(o=this.blx-n)*o+(h=this.bly-a)*h)*f-(r=o*l+h*c)*(s=o*u+h*p))*(g=1/(i*d-r*r)),(_=(d*s-r*f)*g)>=0&&y>0&&_+y<1)},i.prototype.at=function(t,e){if(e)switch(t){case 0:case 4:default:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx}else switch(t){case 0:case 4:default:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,r){if(this.contains_pt(t,e)||this.contains_pt(i,r))return!0;var s,n,a,o,h;for(h=0;h<4;h++)if(s=this.at(h,!0),n=this.at(h,!1),a=this.at(h+1,!0),o=this.at(h+1,!1),cr.segments_intersect(t,e,i,r,s,n,a,o))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,r,s,n,a,o,h,l,c,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(l=0;l<4;l++)for(c=0;c<4;c++)if(e=this.at(l,!0),i=this.at(l,!1),r=this.at(l+1,!0),s=this.at(l+1,!1),n=t.at(c,!0),a=t.at(c,!1),o=t.at(c+1,!0),h=t.at(c+1,!1),cr.segments_intersect(e,i,r,s,n,a,o,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){var r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},cr.arrayRemove=function(t,e){var i,r;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,r=t.length-1;i<r;i++)t[i]=t[i+1];cr.truncateArray(t,r)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,r;for(cr.clearArray(t),i=0,r=e.length;i<r;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:t>i?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,r){var s=i-t,n=r-e;return Math.atan2(n,s)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),r=Math.cos(t),s=i*Math.sin(e)+r*Math.cos(e);return s>=1?0:s<=-1?cr.PI:Math.acos(s)},cr.angleRotate=function(t,e,i){var r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),a=Math.cos(e);return Math.acos(r*n+s*a)>i?s*n-r*a>0?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,r,s,n){if(0===i)return n?t:e;var a=Math.sin(i),o=Math.cos(i),h=(t-=r)*a;return t=t*o-(e-=s)*a,e=e*o+h,t+=r,e+=s,n?t:e},cr.distanceTo=function(t,e,i,r){var s=i-t,n=r-e;return Math.sqrt(s*s+n*n)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var r=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+r*i:t-r*i},cr.qarp=function(t,e,i,r){return cr.lerp(cr.lerp(t,e,r),cr.lerp(e,i,r),r)},cr.cubic=function(t,e,i,r,s){return cr.lerp(cr.qarp(t,e,i,s),cr.qarp(e,i,r,s),s)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var a=+new Date;cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-a};var o=!1,h=!1,l=!1;"undefined"!=typeof window&&(o=!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),h=/(iphone|ipod|ipad)/i.test(navigator.userAgent),l=window.c2ejecta);var c=!o&&!l&&!h&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function u(){this.s=null,this.items=null,this.item_count=0,c&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}u.prototype.contains=function(t){return!this.isEmpty()&&(c?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},u.prototype.add=function(t){if(c)this.s.has(t)||(this.s.add(t),this.cache_valid=!1);else{var e=t.toString(),i=this.items;i?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1)}},u.prototype.remove=function(t){if(!this.isEmpty())if(c)this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1);else if(this.items){var e=t.toString(),i=this.items;i.hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)}},u.prototype.clear=function(){this.isEmpty()||(c?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},u.prototype.isEmpty=function(){return 0===this.count()},u.prototype.count=function(){return c?this.s.size:this.item_count};var p=null,d=0;function f(t){p[d++]=t}u.prototype.update_cache=function(){if(!this.cache_valid){if(c)cr.clearArray(this.values_cache),p=this.values_cache,d=0,this.s.forEach(f),p=null,d=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,r=this.items;if(r)for(e in r)r.hasOwnProperty(e)&&(t[i++]=r[e])}this.cache_valid=!0}},u.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=u;var g=new cr.ObjectSet;function _(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function y(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function m(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function v(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){var e,i;for(e=0,i=t.length;e<i;++e)g.add(t[e]);cr.shallowAssignArray(t,g.valuesRef()),g.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){c?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){var i,r,s,n;for(i=0,r=0,s=t.length;i<s;++i)n=t[i],e.has(n)||(t[r++]=n);cr.truncateArray(t,r)},cr.arrayRemoveAll_arr=function(t,e){var i,r,s,n;for(i=0,r=0,s=t.length;i<s;++i)n=t[i],-1===cr.fastIndexOf(e,n)&&(t[r++]=n);cr.truncateArray(t,r)},_.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},_.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=_,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},y.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},y.prototype.is_empty=function(){return!this.pts_array.length},y.prototype.update_bbox=function(){for(var t,e,i,r=this.pts_cache,s=r[0],n=s,a=r[1],o=a,h=1,l=this.pts_count;h<l;++h)(t=r[i=2*h])<s&&(s=t),t>n&&(n=t),(e=r[i+1])<a&&(a=e),e>o&&(o=e);this.bboxLeft=s,this.bboxRight=n,this.bboxTop=a,this.bboxBottom=o},y.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var r=this.pts_cache;r[0]=t.left-e,r[1]=t.top-i,r[2]=t.right-e,r[3]=t.top-i,r[4]=t.right-e,r[5]=t.bottom-i,r[6]=t.left-e,r[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},y.prototype.set_from_quad=function(t,e,i,r,s){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=t.tlx-e,n[1]=t.tly-i,n[2]=t.trx-e,n[3]=t.try_-i,n[4]=t.brx-e,n[5]=t.bry-i,n[6]=t.blx-e,n[7]=t.bly-i,this.cache_width=r,this.cache_height=s,this.update_bbox()},y.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop=t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},y.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var r,s,n,a,o,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var l=0,c=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(l=Math.sin(i),c=Math.cos(i)),r=0,a=this.pts_count;r<a;r++)n=(s=2*r)+1,o=u[s]*t,h=u[n]*e,p[s]=o*c-h*l,p[n]=h*c+o*l;this.update_bbox()}},y.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;var r,s,n,a,o,h,l,c=this.pts_count,u=this.bboxLeft-110,p=this.bboxTop-101,d=this.bboxRight+131,f=this.bboxBottom+120,g=0,_=0;for(r=0;r<c;r++)n=(r+1)%c*2,a=i[s=2*r],o=i[s+1],h=i[n],l=i[n+1],cr.segments_intersect(u,p,t,e,a,o,h,l)&&g++,cr.segments_intersect(d,f,t,e,a,o,h,l)&&_++;return g%2==1||_%2==1},y.prototype.intersects_poly=function(t,e,i){var r,s,n,a,o,h,l,c,u,p,d,f,g,_,y,m,v=t.pts_cache,w=this.pts_cache;if(this.contains_pt(v[0]+e,v[1]+i))return!0;if(t.contains_pt(w[0]-e,w[1]-i))return!0;for(r=0,a=this.pts_count;r<a;r++)for(n=(r+1)%a*2,u=w[s=2*r],p=w[s+1],d=w[n],f=w[n+1],o=0,c=t.pts_count;o<c;o++)if(l=(o+1)%c*2,g=v[h=2*o]+e,_=v[h+1]+i,y=v[l]+e,m=v[l+1]+i,cr.segments_intersect(u,p,d,f,g,_,y,m))return!0;return!1},y.prototype.intersects_segment=function(t,e,i,r,s,n){var a,o,h,l,c,u,p,d,f=this.pts_cache;if(this.contains_pt(i-t,r-e))return!0;for(a=0,o=this.pts_count;a<o;a++)if(l=(a+1)%o*2,c=f[h=2*a]+t,u=f[h+1]+e,p=f[l]+t,d=f[l+1]+e,cr.segments_intersect(i,r,s,n,c,u,p,d))return!0;return!1},y.prototype.mirror=function(t){var e,i,r;for(e=0,i=this.pts_count;e<i;++e)r=2*e,this.pts_cache[r]=2*t-this.pts_cache[r]},y.prototype.flip=function(t){var e,i,r;for(e=0,i=this.pts_count;e<i;++e)r=2*e+1,this.pts_cache[r]=2*t-this.pts_cache[r]},y.prototype.diag=function(){var t,e,i,r,s;for(t=0,e=this.pts_count;t<e;++t)r=(i=2*t)+1,s=this.pts_cache[i],this.pts_cache[i]=this.pts_cache[r],this.pts_cache[r]=s},cr.CollisionPoly=y,m.prototype.totalCellCount=0,m.prototype.getCell=function(t,e,i){var r,s=this.cells[t];return s?(r=s[e])||(i?(r=b(this,t,e),this.cells[t][e]=r,r):null):i?(r=b(this,t,e),this.cells[t]={},this.cells[t][e]=r,r):null},m.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},m.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},m.prototype.update=function(t,e,i){var r,s,n,a,o;if(e)for(r=e.left,s=e.right;r<=s;++r)for(n=e.top,a=e.bottom;n<=a;++n)i&&i.contains_pt(r,n)||(o=this.getCell(r,n,!1))&&(o.remove(t),o.isEmpty()&&(x(o),this.cells[r][n]=null));if(i)for(r=i.left,s=i.right;r<=s;++r)for(n=i.top,a=i.bottom;n<=a;++n)e&&e.contains_pt(r,n)||this.getCell(r,n,!0).insert(t)},m.prototype.queryRange=function(t,e){var i,r,s,n,a,o;for(i=this.XToCell(t.left),s=this.YToCell(t.top),r=this.XToCell(t.right),a=this.YToCell(t.bottom);i<=r;++i)for(n=s;n<=a;++n)(o=this.getCell(i,n,!1))&&o.dump(e)},cr.SparseGrid=m,v.prototype.totalCellCount=0,v.prototype.getCell=function(t,e,i){var r,s=this.cells[t];return s?(r=s[e])||(i?(r=C(this,t,e),this.cells[t][e]=r,r):null):i?(r=C(this,t,e),this.cells[t]={},this.cells[t][e]=r,r):null},v.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},v.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},v.prototype.update=function(t,e,i){var r,s,n,a,o;if(e)for(r=e.left,s=e.right;r<=s;++r)for(n=e.top,a=e.bottom;n<=a;++n)i&&i.contains_pt(r,n)||(o=this.getCell(r,n,!1))&&(o.remove(t),o.isEmpty()&&(E(o),this.cells[r][n]=null));if(i)for(r=i.left,s=i.right;r<=s;++r)for(n=i.top,a=i.bottom;n<=a;++n)e&&e.contains_pt(r,n)||this.getCell(r,n,!0).insert(t)},v.prototype.queryRange=function(t,e,i,r,s){var n,a,o,h,l,c;for(n=this.XToCell(t),o=this.YToCell(e),a=this.XToCell(i),l=this.YToCell(r);n<=a;++n)for(h=o;h<=l;++h)(c=this.getCell(n,h,!1))&&c.dump(s)},v.prototype.markRangeChanged=function(t){var e,i,r,s,n,a;for(e=t.left,r=t.top,i=t.right,n=t.bottom;e<=i;++e)for(s=r;s<=n;++s)(a=this.getCell(e,s,!1))&&(a.is_sorted=!1)},cr.RenderGrid=v;var w=[];function b(t,e,i){var r;return m.prototype.totalCellCount++,w.length?((r=w.pop()).grid=t,r.x=e,r.y=i,r):new cr.GridCell(t,e,i)}function x(t){m.prototype.totalCellCount--,t.objects.clear(),w.length<1e3&&w.push(t)}function S(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}S.prototype.isEmpty=function(){return this.objects.isEmpty()},S.prototype.insert=function(t){this.objects.add(t)},S.prototype.remove=function(t){this.objects.remove(t)},S.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=S;var T=[];function C(t,e,i){var r;return v.prototype.totalCellCount++,T.length?((r=T.pop()).grid=t,r.x=e,r.y=i,r):new cr.RenderCell(t,e,i)}function E(t){v.prototype.totalCellCount--,t.reset(),T.length<1e3&&T.push(t)}function A(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function P(t,e){return t.zindex-e.zindex}A.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},A.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},A.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,this.pending_removal.count()>=30&&this.flush_pending()},A.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},A.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(P),this.is_sorted=!0)},A.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},A.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=A;var R=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||t>=11?"source-over":R[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],s=t[2],n=Math.sqrt(i*i+r*r+s*s);return n?1===n?(e[0]=i,e[1]=r,e[2]=s,e):(n=1/n,e[0]=i*n,e[1]=r*n,e[2]=s*n,e):(e[0]=0,e[1]=0,e[2]=0,e)},vec3.cross=function(t,e,i){i||(i=t);var r=t[0],s=t[1],n=(t=t[2],e[0]),a=e[1];e=e[2];return i[0]=s*e-t*a,i[1]=t*n-r*e,i[2]=r*a-s*n,i},vec3.length=function(t){var e=t[0],i=t[1];t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var r=t[0]-e[0],s=t[1]-e[1];t=t[2]-e[2];return(e=Math.sqrt(r*r+s*s+t*t))?(e=1/e,i[0]=r*e,i[1]=s*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},vec3.lerp=function(t,e,i,r){return r||(r=t),r[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=s,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],s=t[3],n=t[6],a=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=n,t[11]=t[14],t[12]=s,t[13]=a,t[14]=o,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],p=t[11],d=t[12],f=t[13],g=t[14];return d*c*o*s-l*f*o*s-d*a*u*s+n*f*u*s+l*a*g*s-n*c*g*s-d*c*r*h+l*f*r*h+d*i*u*h-e*f*u*h-l*i*g*h+e*c*g*h+d*a*r*p-n*f*r*p-d*i*o*p+e*f*o*p+n*i*g*p-e*a*g*p-l*a*r*(t=t[15])+n*c*r*t+l*i*o*t-e*c*o*t-n*i*u*t+e*a*u*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],p=t[10],d=t[11],f=t[12],g=t[13],_=t[14],y=t[15],m=i*o-r*a,v=i*h-s*a,w=i*l-n*a,b=r*h-s*o,x=r*l-n*o,S=s*l-n*h,T=c*g-u*f,C=c*_-p*f,E=c*y-d*f,A=u*_-p*g,P=u*y-d*g,R=p*y-d*_,B=1/(m*R-v*P+w*A+b*E-x*C+S*T);return e[0]=(o*R-h*P+l*A)*B,e[1]=(-r*R+s*P-n*A)*B,e[2]=(g*S-_*x+y*b)*B,e[3]=(-u*S+p*x-d*b)*B,e[4]=(-a*R+h*E-l*C)*B,e[5]=(i*R-s*E+n*C)*B,e[6]=(-f*S+_*w-y*v)*B,e[7]=(c*S-p*w+d*v)*B,e[8]=(a*P-o*E+l*T)*B,e[9]=(-i*P+r*E-n*T)*B,e[10]=(f*x-g*w+y*m)*B,e[11]=(-c*x+u*w-d*m)*B,e[12]=(-a*A+o*C-h*T)*B,e[13]=(i*A-r*C+s*T)*B,e[14]=(-f*b+g*v-_*m)*B,e[15]=(c*b-u*v+p*m)*B,e},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],r=t[1],s=t[2],n=t[4],a=t[5],o=t[6],h=t[8],l=t[9],c=t[10],u=c*a-o*l,p=-c*n+o*h,d=l*n-a*h,f=i*u+r*p+s*d;return f?(f=1/f,e||(e=mat3.create()),e[0]=u*f,e[1]=(-c*r+s*l)*f,e[2]=(o*r-s*a)*f,e[3]=p*f,e[4]=(c*i-s*h)*f,e[5]=(-o*i+s*n)*f,e[6]=d*f,e[7]=(-l*i+r*h)*f,e[8]=(a*i-r*n)*f,e):null},mat4.multiply=function(t,e,i){i||(i=t);var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],f=t[11],g=t[12],_=t[13],y=t[14],m=(t=t[15],e[0]),v=e[1],w=e[2],b=e[3],x=e[4],S=e[5],T=e[6],C=e[7],E=e[8],A=e[9],P=e[10],R=e[11],B=e[12],k=e[13],O=e[14];e=e[15];return i[0]=m*r+v*o+w*u+b*g,i[1]=m*s+v*h+w*p+b*_,i[2]=m*n+v*l+w*d+b*y,i[3]=m*a+v*c+w*f+b*t,i[4]=x*r+S*o+T*u+C*g,i[5]=x*s+S*h+T*p+C*_,i[6]=x*n+S*l+T*d+C*y,i[7]=x*a+S*c+T*f+C*t,i[8]=E*r+A*o+P*u+R*g,i[9]=E*s+A*h+P*p+R*_,i[10]=E*n+A*l+P*d+R*y,i[11]=E*a+A*c+P*f+R*t,i[12]=B*r+k*o+O*u+e*g,i[13]=B*s+k*h+O*p+e*_,i[14]=B*n+k*l+O*d+e*y,i[15]=B*a+k*c+O*f+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],s=e[1];e=e[2];return i[0]=t[0]*r+t[4]*s+t[8]*e+t[12],i[1]=t[1]*r+t[5]*s+t[9]*e+t[13],i[2]=t[2]*r+t[6]*s+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var r=e[0],s=e[1],n=e[2];e=e[3];return i[0]=t[0]*r+t[4]*s+t[8]*n+t[12]*e,i[1]=t[1]*r+t[5]*s+t[9]*n+t[13]*e,i[2]=t[2]*r+t[6]*s+t[10]*n+t[14]*e,i[3]=t[3]*r+t[7]*s+t[11]*n+t[15]*e,i},mat4.translate=function(t,e,i){var r,s,n,a,o,h,l,c,u,p,d,f,g=e[0],_=e[1];e=e[2];return i&&t!==i?(r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],f=t[11],i[0]=r,i[1]=s,i[2]=n,i[3]=a,i[4]=o,i[5]=h,i[6]=l,i[7]=c,i[8]=u,i[9]=p,i[10]=d,i[11]=f,i[12]=r*g+o*_+u*e+t[12],i[13]=s*g+h*_+p*e+t[13],i[14]=n*g+l*_+d*e+t[14],i[15]=a*g+c*_+f*e+t[15],i):(t[12]=t[0]*g+t[4]*_+t[8]*e+t[12],t[13]=t[1]*g+t[5]*_+t[9]*e+t[13],t[14]=t[2]*g+t[6]*_+t[10]*e+t[14],t[15]=t[3]*g+t[7]*_+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var r=e[0],s=e[1];e=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=s,t[5]*=s,t[6]*=s,t[7]*=s,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,r){var s,n,a,o,h,l,c,u,p,d,f,g,_,y,m,v,w,b,x,S,T=i[0],C=i[1],E=(i=i[2],Math.sqrt(T*T+C*C+i*i));return E?(1!==E&&(T*=E=1/E,C*=E,i*=E),s=Math.sin(e),a=1-(n=Math.cos(e)),e=t[0],E=t[1],o=t[2],h=t[3],l=t[4],c=t[5],u=t[6],p=t[7],d=t[8],f=t[9],g=t[10],_=t[11],y=T*T*a+n,m=C*T*a+i*s,v=i*T*a-C*s,w=T*C*a-i*s,b=C*C*a+n,x=i*C*a+T*s,S=T*i*a+C*s,T=C*i*a-T*s,C=i*i*a+n,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*y+l*m+d*v,r[1]=E*y+c*m+f*v,r[2]=o*y+u*m+g*v,r[3]=h*y+p*m+_*v,r[4]=e*w+l*b+d*x,r[5]=E*w+c*b+f*x,r[6]=o*w+u*b+g*x,r[7]=h*w+p*b+_*x,r[8]=e*S+l*T+d*C,r[9]=E*S+c*T+f*C,r[10]=o*S+u*T+g*C,r[11]=h*S+p*T+_*C,r):null},mat4.rotateX=function(t,e,i){var r=Math.sin(e),s=(e=Math.cos(e),t[4]),n=t[5],a=t[6],o=t[7],h=t[8],l=t[9],c=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=s*e+h*r,i[5]=n*e+l*r,i[6]=a*e+c*r,i[7]=o*e+u*r,i[8]=s*-r+h*e,i[9]=n*-r+l*e,i[10]=a*-r+c*e,i[11]=o*-r+u*e,i},mat4.rotateY=function(t,e,i){var r=Math.sin(e),s=(e=Math.cos(e),t[0]),n=t[1],a=t[2],o=t[3],h=t[8],l=t[9],c=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*-r,i[1]=n*e+l*-r,i[2]=a*e+c*-r,i[3]=o*e+u*-r,i[8]=s*r+h*e,i[9]=n*r+l*e,i[10]=a*r+c*e,i[11]=o*r+u*e,i},mat4.rotateZ=function(t,e,i){var r=Math.sin(e),s=(e=Math.cos(e),t[0]),n=t[1],a=t[2],o=t[3],h=t[4],l=t[5],c=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*r,i[1]=n*e+l*r,i[2]=a*e+c*r,i[3]=o*e+u*r,i[4]=s*-r+h*e,i[5]=n*-r+l*e,i[6]=a*-r+c*e,i[7]=o*-r+u*e,i},mat4.frustum=function(t,e,i,r,s,n,a){a||(a=mat4.create());var o=e-t,h=r-i,l=n-s;return a[0]=2*s/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*s/h,a[6]=0,a[7]=0,a[8]=(e+t)/o,a[9]=(r+i)/h,a[10]=-(n+s)/l,a[11]=-1,a[12]=0,a[13]=0,a[14]=-n*s*2/l,a[15]=0,a},mat4.perspective=function(t,e,i,r,s){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,r,s)},mat4.ortho=function(t,e,i,r,s,n,a){a||(a=mat4.create());var o=e-t,h=r-i,l=n-s;return a[0]=2/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/h,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/l,a[11]=0,a[12]=-(t+e)/o,a[13]=-(r+i)/h,a[14]=-(n+s)/l,a[15]=1,a},mat4.lookAt=function(t,e,i,r){r||(r=mat4.create());var s,n,a,o,h,l,c,u,p=t[0],d=t[1];t=t[2];return n=i[0],a=i[1],s=i[2],i=e[1],l=e[2],p===e[0]&&d===i&&t===l?mat4.identity(r):(i=p-e[0],l=d-e[1],c=t-e[2],e=a*(c*=u=1/Math.sqrt(i*i+l*l+c*c))-s*(l*=u),s=s*(i*=u)-n*c,n=n*l-a*i,(u=Math.sqrt(e*e+s*s+n*n))?(e*=u=1/u,s*=u,n*=u):n=s=e=0,a=l*n-c*s,o=c*e-i*n,h=i*s-l*e,(u=Math.sqrt(a*a+o*o+h*h))?(a*=u=1/u,o*=u,h*=u):h=o=a=0,r[0]=e,r[1]=a,r[2]=i,r[3]=0,r[4]=s,r[5]=o,r[6]=l,r[7]=0,r[8]=n,r[9]=h,r[10]=c,r[11]=0,r[12]=-(e*p+s*d+n*t),r[13]=-(a*p+o*d+h*t),r[14]=-(i*p+l*d+c*t),r[15]=1,r)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var r=t[0],s=t[1],n=t[2],a=t[3],o=r+r,h=s+s,l=n+n,c=(t=r*o,r*h);r*=l;var u=s*h;return s*=l,n*=l,o*=a,h*=a,a*=l,i[0]=1-(u+n),i[1]=c+a,i[2]=r-h,i[3]=0,i[4]=c-a,i[5]=1-(t+n),i[6]=s+o,i[7]=0,i[8]=r+h,i[9]=s-o,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],r=t[1],s=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=s,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],r=t[2];t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],r=t[1],s=t[2],n=t[3],a=Math.sqrt(i*i+r*r+s*s+n*n);return 0===a?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(a=1/a,e[0]=i*a,e[1]=r*a,e[2]=s*a,e[3]=n*a,e)},quat4.multiply=function(t,e,i){i||(i=t);var r=t[0],s=t[1],n=t[2],a=(t=t[3],e[0]),o=e[1],h=e[2];e=e[3];return i[0]=r*e+t*a+s*h-n*o,i[1]=s*e+t*o+n*a-r*h,i[2]=n*e+t*h+r*o-s*a,i[3]=t*e-r*a-s*o-n*h,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var r=e[0],s=e[1],n=e[2],a=(e=t[0],t[1]),o=t[2],h=(t=t[3])*r+a*n-o*s,l=t*s+o*r-e*n,c=t*n+e*s-a*r;r=-e*r-a*s-o*n;return i[0]=h*t+r*-e+l*-o-c*-a,i[1]=l*t+r*-a+c*-e-h*-o,i[2]=c*t+r*-o+h*-a-l*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],r=t[1],s=t[2],n=t[3],a=i+i,o=r+r,h=s+s,l=i*a,c=i*o;i*=h;var u=r*o;return r*=h,s*=h,a*=n,o*=n,n*=h,e[0]=1-(u+s),e[1]=c+n,e[2]=i-o,e[3]=c-n,e[4]=1-(l+s),e[5]=r+a,e[6]=i+o,e[7]=r-a,e[8]=1-(l+u),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],r=t[1],s=t[2],n=t[3],a=i+i,o=r+r,h=s+s,l=i*a,c=i*o;i*=h;var u=r*o;return r*=h,s*=h,a*=n,o*=n,n*=h,e[0]=1-(u+s),e[1]=c+n,e[2]=i-o,e[3]=0,e[4]=c-n,e[5]=1-(l+s),e[6]=r+a,e[7]=0,e[8]=i+o,e[9]=r-a,e[10]=1-(l+u),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,r){r||(r=t);var s,n,a=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(a)>=1?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(s=Math.acos(a),n=Math.sqrt(1-a*a),Math.abs(n)<.001?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3],r):(a=Math.sin((1-i)*s)/n,i=Math.sin(i*s)/n,r[0]=t[0]*a+e[0]*i,r[1]=t[1]*a+e[1]*i,r[2]=t[2]*a+e[2]*i,r[3]=t[3]*a+e[3]*i,r))},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var t=8e3,e=mat4.create();function i(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function r(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function s(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function n(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}i.prototype.initState=function(){var e,i=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.CULL_FACE),i.disable(i.STENCIL_TEST),i.disable(i.DITHER),this.enableFrontToBack?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.lastSrcBlend=i.ONE,this.lastDestBlend=i.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(t*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.pointBuffer),i.bufferData(i.ARRAY_BUFFER,this.pointData.byteLength,i.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),e=0;e<4;e++)this.vertexBuffers[e]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffers[e]),i.bufferData(i.ARRAY_BUFFER,this.vertexData.byteLength,i.DYNAMIC_DRAW),this.texcoordBuffers[e]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffers[e]),i.bufferData(i.ARRAY_BUFFER,this.texcoordData.byteLength,i.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var r=new Uint16Array(12e3);e=0;for(var s,n,a=0;e<12e3;)r[e++]=a,r[e++]=a+1,r[e++]=a+2,r[e++]=a,r[e++]=a+2,r[e++]=a+3,a+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,r,i.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],s=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),n=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var o=this.createShaderProgram({src:s},n,"<default>");this.shaderPrograms.push(o),s=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var h=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");o=this.createShaderProgram({src:s},h,"<point>"),this.shaderPrograms.push(o),s=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");o=this.createShaderProgram({src:s},n,"<earlyz>");this.shaderPrograms.push(o),s=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");o=this.createShaderProgram({src:s},n,"<fill>");for(var l in this.shaderPrograms.push(o),cr.shaders)cr.shaders.hasOwnProperty(l)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[l],n,l));i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=i.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=i.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var c=i.getParameter(i.ALIASED_POINT_SIZE_RANGE);this.minPointSize=c[0],this.maxPointSize=c[1],this.maxPointSize>2048&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},r.prototype.updateMatMV=function(t){s(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},i.prototype.createShaderProgram=function(t,e,i){var s=this.gl,n=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(n,t.src),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){var a=s.getShaderInfoLog(n);throw s.deleteShader(n),new Error("error compiling fragment shader: "+a)}var o=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(o,e),s.compileShader(o),!s.getShaderParameter(o,s.COMPILE_STATUS)){a=s.getShaderInfoLog(o);throw s.deleteShader(n),s.deleteShader(o),new Error("error compiling vertex shader: "+a)}var h=s.createProgram();if(s.attachShader(h,n),s.attachShader(h,o),s.linkProgram(h),!s.getProgramParameter(h,s.LINK_STATUS)){a=s.getProgramInfoLog(h);throw s.deleteShader(n),s.deleteShader(o),s.deleteProgram(h),new Error("error linking shader program: "+a)}s.useProgram(h),s.deleteShader(n),s.deleteShader(o);var l,c,u=new r(s,h,i);for(u.extendBoxHorizontal=t.extendBoxHorizontal||0,u.extendBoxVertical=t.extendBoxVertical||0,u.crossSampling=!!t.crossSampling,u.preservesOpaqueness=!!t.preservesOpaqueness,u.animated=!!t.animated,u.parameters=t.parameters||[],l=0,c=u.parameters.length;l<c;l++)u.parameters[l][1]=s.getUniformLocation(h,u.parameters[l][0]),u.lastCustomParams.push(0),s.uniform1f(u.parameters[l][1],0);return cr.seal(u),u},i.prototype.getShaderIndex=function(t){var e,i;for(e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},i.prototype.project=function(t,e,i){var r=this.matMV,s=this.matP,n=[0,0,0,0,0,0,0,0];n[0]=r[0]*t+r[4]*e+r[12],n[1]=r[1]*t+r[5]*e+r[13],n[2]=r[2]*t+r[6]*e+r[14],n[3]=r[3]*t+r[7]*e+r[15],n[4]=s[0]*n[0]+s[4]*n[1]+s[8]*n[2]+s[12]*n[3],n[5]=s[1]*n[0]+s[5]*n[1]+s[9]*n[2]+s[13]*n[3],n[6]=s[2]*n[0]+s[6]*n[1]+s[10]*n[2]+s[14]*n[3],n[7]=-n[2],0!==n[7]&&(n[7]=1/n[7],n[4]*=n[7],n[5]*=n[7],n[6]*=n[7],i[0]=(.5*n[4]+.5)*this.width,i[1]=(.5*n[5]+.5)*this.height)},i.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var r,s,n,a=this.gl;if(this.width=t,this.height=e,a.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP);var o=[0,0],h=[0,0];this.project(0,0,o),this.project(1,1,h),this.worldScale[0]=1/(h[0]-o[0]),this.worldScale[1]=-1/(h[1]-o[1])}for(r=0,s=this.shaderPrograms.length;r<s;r++)(n=this.shaderPrograms[r]).hasCurrentMatMV=!1,n.locMatP&&(a.useProgram(n.shaderProgram),a.uniformMatrix4fv(n.locMatP,!1,this.matP));a.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.bindRenderbuffer(a.RENDERBUFFER,this.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),this.renderToTex=null)}},i.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},i.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},i.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},i.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},i.prototype.updateModelView=function(){if(!s(this.lastMV,this.matMV)){var t=this.pushBatch();t.type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(t>32760&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},n.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},n.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},n.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},n.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},n.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},n.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},n.prototype.doUpdateModelView=function(){var t,e,i,r=this.glwrap.shaderPrograms,s=this.glwrap.currentProgram;for(t=0,e=r.length;t<e;t++)i=r[t],t===s&&i.locMatMV?(i.updateMatMV(this.mat4param),i.hasCurrentMatMV=!0):i.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},n.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},n.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},n.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},n.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},n.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},n.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},n.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,r=this.gl,s=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,r.activeTexture(r.TEXTURE0));var n,a=s[0];if(i.locPixelWidth&&a!==i.lpPixelWidth&&(i.lpPixelWidth=a,r.uniform1f(i.locPixelWidth,a)),a=s[1],i.locPixelHeight&&a!==i.lpPixelHeight&&(i.lpPixelHeight=a,r.uniform1f(i.locPixelHeight,a)),a=s[2],n=s[3],!i.locDestStart||a===i.lpDestStartX&&n===i.lpDestStartY||(i.lpDestStartX=a,i.lpDestStartY=n,r.uniform2f(i.locDestStart,a,n)),a=s[4],n=s[5],!i.locDestEnd||a===i.lpDestEndX&&n===i.lpDestEndY||(i.lpDestEndX=a,i.lpDestEndY=n,r.uniform2f(i.locDestEnd,a,n)),a=s[6],i.locLayerScale&&a!==i.lpLayerScale&&(i.lpLayerScale=a,r.uniform1f(i.locLayerScale,a)),a=s[7],i.locLayerAngle&&a!==i.lpLayerAngle&&(i.lpLayerAngle=a,r.uniform1f(i.locLayerAngle,a)),a=s[8],n=s[9],!i.locViewOrigin||a===i.lpViewOriginX&&n===i.lpViewOriginY||(i.lpViewOriginX=a,i.lpViewOriginY=n,r.uniform2f(i.locViewOrigin,a,n)),a=s[10],n=s[11],!i.locScrollPos||a===i.lpScrollPosX&&n===i.lpScrollPosY||(i.lpScrollPosX=a,i.lpScrollPosY=n,r.uniform2f(i.locScrollPos,a,n)),a=s[12],i.locSeconds&&a!==i.lpSeconds&&(i.lpSeconds=a,r.uniform1f(i.locSeconds,a)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)(a=this.shaderParams[t])!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=a,r.uniform1f(i.parameters[t][1],a))},i.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new n(0,this)),this.batch[this.batchPtr++]},i.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,r=this.gl;if(this.pointPtr>0&&(r.bindBuffer(r.ARRAY_BUFFER,this.pointBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),s&&s.locAPos>=0&&"<point>"===s.name&&r.vertexAttribPointer(s.locAPos,4,r.FLOAT,!1,0,0)),this.vertexPtr>0){var s=this.currentShader;r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),s&&s.locAPos>=0&&"<point>"!==s.name&&r.vertexAttribPointer(s.locAPos,this.enableFrontToBack?3:2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),s&&s.locATex>=0&&"<point>"!==s.name&&r.vertexAttribPointer(s.locATex,2,r.FLOAT,!1,0,0)}for(t=0,e=this.batchPtr;t<e;t++)switch((i=this.batch[t]).type){case 1:i.doQuad();break;case 2:i.doSetTexture();break;case 3:i.doSetOpacity();break;case 4:i.doSetBlend();break;case 5:i.doUpdateModelView();break;case 6:i.doRenderToTexture();break;case 7:i.doClear();break;case 8:i.doPoints();break;case 9:i.doSetProgram();break;case 10:i.doSetProgramParameters();break;case 11:i.doSetTexture1();break;case 12:i.doSetColor();break;case 13:i.doSetDepthTestEnabled();break;case 14:i.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,this.curBuffer>=4&&(this.curBuffer=0)}},i.prototype.setOpacity=function(t){if(t!==this.lastOpacity&&!this.isEarlyZPass){var e=this.pushBatch();e.type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setTexture=function(t){if(t!==this.lastTexture0){var e=this.pushBatch();e.type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.setBlend=function(t,e){if((t!==this.lastSrcBlend||e!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},i.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},i.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};var a=15992;i.prototype.quad=function(t,e,i,r,s,n,o,h){this.vertexPtr>=a&&this.endBatch();var l=this.vertexPtr,c=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var f=this.pushBatch();f.type=1,f.startIndex=this.enableFrontToBack?l:l/2*3,f.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(u[l++]=t,u[l++]=e,u[l++]=d,u[l++]=i,u[l++]=r,u[l++]=d,u[l++]=s,u[l++]=n,u[l++]=d,u[l++]=o,u[l++]=h,u[l++]=d):(u[l++]=t,u[l++]=e,u[l++]=i,u[l++]=r,u[l++]=s,u[l++]=n,u[l++]=o,u[l++]=h),p[c++]=0,p[c++]=0,p[c++]=1,p[c++]=0,p[c++]=1,p[c++]=1,p[c++]=0,p[c++]=1,this.vertexPtr=l,this.texPtr=c},i.prototype.quadTex=function(t,e,i,r,s,n,o,h,l){this.vertexPtr>=a&&this.endBatch();var c=this.vertexPtr,u=this.texPtr,p=this.vertexData,d=this.texcoordData,f=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var g=this.pushBatch();g.type=1,g.startIndex=this.enableFrontToBack?c:c/2*3,g.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var _=l.left,y=l.top,m=l.right,v=l.bottom;this.enableFrontToBack?(p[c++]=t,p[c++]=e,p[c++]=f,p[c++]=i,p[c++]=r,p[c++]=f,p[c++]=s,p[c++]=n,p[c++]=f,p[c++]=o,p[c++]=h,p[c++]=f):(p[c++]=t,p[c++]=e,p[c++]=i,p[c++]=r,p[c++]=s,p[c++]=n,p[c++]=o,p[c++]=h),d[u++]=_,d[u++]=y,d[u++]=m,d[u++]=y,d[u++]=m,d[u++]=v,d[u++]=_,d[u++]=v,this.vertexPtr=c,this.texPtr=u},i.prototype.quadTexUV=function(t,e,i,r,s,n,o,h,l,c,u,p,d,f,g,_){this.vertexPtr>=a&&this.endBatch();var y=this.vertexPtr,m=this.texPtr,v=this.vertexData,w=this.texcoordData,b=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var x=this.pushBatch();x.type=1,x.startIndex=this.enableFrontToBack?y:y/2*3,x.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(v[y++]=t,v[y++]=e,v[y++]=b,v[y++]=i,v[y++]=r,v[y++]=b,v[y++]=s,v[y++]=n,v[y++]=b,v[y++]=o,v[y++]=h,v[y++]=b):(v[y++]=t,v[y++]=e,v[y++]=i,v[y++]=r,v[y++]=s,v[y++]=n,v[y++]=o,v[y++]=h),w[m++]=l,w[m++]=c,w[m++]=u,w[m++]=p,w[m++]=d,w[m++]=f,w[m++]=g,w[m++]=_,this.vertexPtr=y,this.texPtr=m},i.prototype.convexPoly=function(t){var e,i,r,s,n,a,o,h,l=t.length/2-2,c=l-1,u=t[0],p=t[1];for(e=0;e<l;e+=2)r=t[(i=2*e)+2],s=t[i+3],n=t[i+4],a=t[i+5],e===c?this.quad(u,p,r,s,n,a,n,a):(o=t[i+6],h=t[i+7],this.quad(u,p,r,s,n,a,o,h))};i.prototype.point=function(t,e,i,r){this.pointPtr>=7996&&this.endBatch();var s=this.pointPtr,n=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var a=this.pushBatch();a.type=8,a.startIndex=s,a.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}n[s++]=t,n[s++]=e,n[s++]=i,n[s++]=r,this.pointPtr=s},i.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=9,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},i.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},i.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},i.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},i.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},i.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},i.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},i.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},i.prototype.setProgramParameters=function(t,e,i,r,s,n,a,o,h,l,c,u,p,d,f){var g,_,y,m,v,w=this.shaderPrograms[this.lastProgram];if(w.hasAnyOptionalUniforms||f.length){if((y=this.pushBatch()).type=10,y.mat4param?mat4.set(this.matMV,y.mat4param):y.mat4param=mat4.create(),(m=y.mat4param)[0]=e,m[1]=i,m[2]=r,m[3]=s,m[4]=n,m[5]=a,m[6]=o,m[7]=h,m[8]=l,m[9]=c,m[10]=u,m[11]=p,m[12]=d,w.locSamplerBack?y.texParam=t:y.texParam=null,f.length)for((v=y.shaderParams).length=f.length,g=0,_=f.length;g<_;g++)v[g]=f[g];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.clear=function(t,e,i,r){var s=this.pushBatch();s.type=7,s.startIndex=0,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.clearRect=function(t,e,i,r){if(!(i<0||r<0)){var s=this.pushBatch();s.type=7,s.startIndex=1,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var e=this.pushBatch();e.type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},i.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},i.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,e),this.resetModelView(),this.updateModelView();var t=this.width/2,i=this.height/2;this.quad(-t,i,t,i,t,-i,-t,-i),mat4.set(e,this.matMV),this.updateModelView()},i.prototype.setColorFillMode=function(t,e,i,r){this.switchProgram(3);var s=this.pushBatch();s.type=12,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},i.prototype.setTextureFillMode=function(){this.switchProgram(0)},i.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},i.prototype.present=function(){this.endBatch(),this.gl.flush()};var o=[],h={};i.prototype.contextLost=function(){cr.clearArray(o),h={}};i.prototype.loadTexture=function(t,e,i,r,s,n){e=!!e,i=!!i;var a=t.src+","+e+","+i+(e?","+s:""),l=null;if(void 0!==t.src&&h.hasOwnProperty(a))return(l=h[a]).c2refcount++,l;this.endBatch();var c=this.gl,u=cr.isPOT(t.width)&&cr.isPOT(t.height);l=c.createTexture(),c.bindTexture(c.TEXTURE_2D,l),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var p=c.RGBA,d=c.RGBA,f=c.UNSIGNED_BYTE;if(r&&!this.isIE)switch(r){case 1:p=c.RGB,d=c.RGB;break;case 2:f=c.UNSIGNED_SHORT_4_4_4_4;break;case 3:f=c.UNSIGNED_SHORT_5_5_5_1;break;case 4:p=c.RGB,d=c.RGB,f=c.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!u&&e){var g=document.createElement("canvas");g.width=cr.nextHighestPowerOfTwo(t.width),g.height=cr.nextHighestPowerOfTwo(t.height);var _=g.getContext("2d");void 0!==_.imageSmoothingEnabled?_.imageSmoothingEnabled=i:(_.webkitImageSmoothingEnabled=i,_.mozImageSmoothingEnabled=i,_.msImageSmoothingEnabled=i),_.drawImage(t,0,0,t.width,t.height,0,0,g.width,g.height),c.texImage2D(c.TEXTURE_2D,0,p,d,f,g)}else c.texImage2D(c.TEXTURE_2D,0,p,d,f,t);return e?"repeat-x"===s?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)):"repeat-y"===s?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),i?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),(u||this.version>=2)&&this.enable_mipmaps&&!n?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.generateMipmap(c.TEXTURE_2D)):c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST)),c.bindTexture(c.TEXTURE_2D,null),this.lastTexture0=null,l.c2width=t.width,l.c2height=t.height,l.c2refcount=1,l.c2texkey=a,o.push(l),h[a]=l,l},i.prototype.createEmptyTexture=function(t,e,i,r,s){this.endBatch();var n=this.gl;this.isIE&&(r=!1);var a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,r?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,null),s?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i?n.LINEAR:n.NEAREST),n.bindTexture(n.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t,a.c2height=e,o.push(a),a},i.prototype.videoToTexture=function(t,e,i){this.endBatch();var r=this.gl;this.isIE&&(i=!1),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null},i.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&t.c2refcount>1?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(o,t),void 0!==t.c2texkey&&delete h[t.c2texkey],this.gl.deleteTexture(t)))},i.prototype.estimateVRAM=function(){var t,e,i,r=this.width*this.height*4*2;for(t=0,e=o.length;t<e;t++)r+=(i=o[t]).c2width*i.c2height*4;return r},i.prototype.textureCount=function(){return o.length},i.prototype.setRenderingToTexture=function(t){if(t!==this.renderToTex){var e=this.pushBatch();e.type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=i}(),function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;function e(t){if(t&&(t.getContext||t.dc)&&!t.c2runtime){t.c2runtime=this;var e=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener((function(){e.setSuspended(!0)})),CocoonJS.App.onActivated.addEventListener((function(){e.setSuspended(!1)}))),this.isEjecta&&(document.addEventListener("pagehide",(function(){e.setSuspended(!0)})),document.addEventListener("pageshow",(function(){e.setSuspended(!1)})),document.addEventListener("resize",(function(){e.setSize(window.innerWidth,window.innerHeight)}))),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&window.location.search.indexOf("debug")>-1,this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()}}e.prototype.requestProjectData=function(){var t=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",(function(e){t.loadProject(JSON.parse(e))}),(function(t){alert("Error fetching data.js")}));else{var e;e=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var i="data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(i="data.json"),e.open("GET",i,!0);var r=!1;if(!this.isDomFree&&"response"in e&&"responseType"in e)try{e.responseType="json",r="json"===e.responseType}catch(t){r=!1}if(!r&&"responseType"in e)try{e.responseType="text"}catch(t){}if("overrideMimeType"in e)try{e.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?e.onreadystatechange=function(){4===e.readyState&&t.loadProject(JSON.parse(e.responseText))}:(e.onload=function(){if(r)t.loadProject(e.response);else if(t.isEjecta){var i=e.responseText;i=i.substr(i.indexOf("{")),t.loadProject(JSON.parse(i))}else t.loadProject(JSON.parse(e.responseText))},e.onerror=function(t){cr.logerror("Error requesting "+i+":"),cr.logerror(t)}),e.send()}},e.prototype.initRendererAndLoader=function(){var t,e,i,r,s,n,a,o,h,l,c,u=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),this.ClearDeathRow(),this.fullscreen_mode>0&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",(function(t){t.preventDefault(),u.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)}),!1),this.canvas.addEventListener("webglcontextrestored",(function(t){u.glwrap.initState(),u.glwrap.setSize(u.glwrap.width,u.glwrap.height,!0),u.layer_tex=null,u.layout_tex=null,u.fx_tex[0]=null,u.fx_tex[1]=null,u.onContextRestored(),u.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)}),!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(c={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",c)),this.gl||(this.gl=this.canvas.getContext("webgl",c)||this.canvas.getContext("experimental-webgl",c)))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var p=this.gl.getExtension("WEBGL_debug_renderer_info");if(p){var d=this.gl.getParameter(p.UNMASKED_VENDOR_WEBGL),f=this.gl.getParameter(p.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=f+" ["+d+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(i=0,r=(a=this.types_by_index[t]).effect_types.length;i<r;i++)(o=a.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(o.id),o.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(o.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(o.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,r=(h=this.layouts_by_index[t]).effect_types.length;i<r;i++)(o=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(o.id),o.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(o.shaderindex);for(h.updateActiveEffects(),i=0,r=h.layers.length;i<r;i++){for(s=0,n=(l=h.layers[i]).effect_types.length;s<n;s++)(o=l.effect_types[s]).shaderindex=this.glwrap.getShaderIndex(o.id),o.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(o.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(o.shaderindex);l.updateActiveEffects()}}}else{if(this.fullscreen_mode>0&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(c={antialias:!!this.linearSampling,alpha:!0},this.ctx=this.canvas.getContext("2d",c)):(c={alpha:!0},this.ctx=this.canvas.getContext("2d",c)),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}if(this.tickFunc=function(t){u.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",(function(){window.focus()}),!0),document.addEventListener("touchstart",(function(){window.focus()}),!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),window.location.search.indexOf("continuous")>-1&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus((function(){u.setSuspended(!1)})),jQuery(window).blur((function(){var t=window.parent;t&&t.document.hasFocus()||u.setSuspended(!0)})))),window.addEventListener("blur",(function(){u.onWindowBlur()})),!this.isDomFree){var g=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",g):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",g):document.addEventListener("touchstart",g),document.addEventListener("mousedown",g)}0===this.fullscreen_mode&&this.isRetina&&this.devicePixelRatio>1&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)};e.prototype.setSize=function(t,e,i){var r=0,s=0,n=0,a=0,o=0;if(this.lastWindowWidth!==t||this.lastWindowHeight!==e||i){this.lastWindowWidth=t,this.lastWindowHeight=e;var h,l,c=this.fullscreen_mode,u=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova;if(u||0!==this.fullscreen_mode||i){u&&(c=this.fullscreen_scaling);var p=this.devicePixelRatio;c>=4?(5===c&&1!==p&&(t+=1,e+=1),(l=t/e)>(h=this.original_width/this.original_height)?(n=e*h,5===c?((o=n*p/this.original_width)>1?o=Math.floor(o):o<1&&(o=1/Math.ceil(1/o)),r=(t-(n=this.original_width*o/p))/2,s=(e-(a=this.original_height*o/p))/2,t=n,e=a):(r=(t-n)/2,t=n)):(a=t/h,5===c?((o=a*p/this.original_height)>1?o=Math.floor(o):o<1&&(o=1/Math.ceil(1/o)),r=(t-(n=this.original_width*o/p))/2,s=(e-(a=this.original_height*o/p))/2,t=n,e=a):(s=(e-a)/2,e=a))):u&&0===c&&(r=Math.floor((t-this.original_width)/2),s=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),c<2&&(this.aspect_scale=p),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*p),this.height=Math.round(e*p),this.redraw=!0,this.wantFullscreenScalingQuality||this.width<this.original_width&&this.height<this.original_height||1===c?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===c?(h=this.original_width/this.original_height,(l=this.lastWindowWidth/this.lastWindowHeight)<h?this.draw_width=this.draw_height*l:l>h&&(this.draw_height=this.draw_width/l)):3===c&&(h=this.original_width/this.original_height,(l=this.lastWindowWidth/this.lastWindowHeight)>h?this.draw_width=this.draw_height*l:l<h&&(this.draw_height=this.draw_width/l))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(r)+"px","margin-top":Math.floor(s)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*p),this.canvas.height=Math.round(e*p),this.isEjecta?(this.canvas.style.left=Math.floor(r)+"px",this.canvas.style.top=Math.floor(s)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*p),this.overlay_canvas.height=Math.round(e*p),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*p),Math.round(e*p)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},e.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch((function(){})):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},e.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},e.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()},e.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova?jQuery(this.canvas).offset():jQuery(this.canvas).position();t.position="absolute",jQuery(this.overlay_canvas).css(t)}};var i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;e.prototype.setSuspended=function(t){var e,r;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&i&&i(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,r=this.suspend_events.length;e<r;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,e=0,r=this.suspend_events.length;e<r;e++)this.suspend_events[e](!1);this.tick(!1)}},e.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},e.prototype.GetObjectReference=function(t){return this.objectRefTable[t]},e.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,r,s,n,a,o,h,l,c,u,p,d,f=t.project;if(this.name=f[0],this.first_layout=f[1],this.fullscreen_mode=f[12],this.fullscreen_mode_set=f[12],this.original_width=f[10],this.original_height=f[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(f[12]>=4||0===f[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=f[18],this.loaderstyle=f[19],0===this.loaderstyle){var g=new Image;g.crossOrigin="anonymous",this.setImageSrc(g,"loading-logo.png"),this.loaderlogos={logo:g}}else if(4===this.loaderstyle){var _=new Image;_.src="";var y=new Image;y.src="";var m=new Image;m.src="";var v=new Image;v.src="";var w=new Image;w.src="";var b=new Image;b.src="";var x=new Image;x.src="";var S=new Image;S.src="";var T=new Image;T.src="";var C=new Image;C.src="";var E=new Image;E.src="";var A=new Image;A.src="",this.loaderlogos={logo:[_,y,m,v],powered:[w,b,x,S],website:[T,C,E,A]}}for(this.next_uid=f[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),e=0,i=f[2].length;e<i;e++)o=f[2][e],u=this.GetObjectReference(o[0]),cr.add_common_aces(o,u.prototype),(p=new u(this)).singleglobal=o[1],p.is_world=o[2],p.is_rotatable=o[5],p.must_predraw=o[9],p.onCreate&&p.onCreate(),cr.seal(p),this.plugins.push(p);for(this.objectRefTable=cr.getObjectRefTable(),e=0,i=f[3].length;e<i;e++){for(o=f[3][e],d=this.GetObjectReference(o[1]),p=null,r=0,s=this.plugins.length;r<s;r++)if(this.plugins[r]instanceof d){p=this.plugins[r];break}var P=new p.Type(p);for(P.name=o[0],P.is_family=o[2],P.instvar_sids=o[3].slice(0),P.vars_count=o[3].length,P.behs_count=o[4],P.fx_count=o[5],P.sid=o[11],P.is_family?(P.members=[],P.family_index=this.family_count++,P.families=null):(P.members=null,P.family_index=-1,P.families=[]),P.family_var_map=null,P.family_beh_map=null,P.family_fx_map=null,P.is_contained=!1,P.container=null,o[6]?(P.texture_file=o[6][0],P.texture_filesize=o[6][1],P.texture_pixelformat=o[6][2]):(P.texture_file=null,P.texture_filesize=0,P.texture_pixelformat=0),o[7]?P.animations=o[7]:P.animations=null,P.index=e,P.instances=[],P.deadCache=[],P.solstack=[new cr.selection(P)],P.cur_sol=0,P.default_instance=null,P.default_layerindex=0,P.stale_iids=!0,P.updateIIDs=cr.type_updateIIDs,P.getFirstPicked=cr.type_getFirstPicked,P.getPairedInstance=cr.type_getPairedInstance,P.getCurrentSol=cr.type_getCurrentSol,P.pushCleanSol=cr.type_pushCleanSol,P.pushCopySol=cr.type_pushCopySol,P.popSol=cr.type_popSol,P.getBehaviorByName=cr.type_getBehaviorByName,P.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,P.getEffectIndexByName=cr.type_getEffectIndexByName,P.applySolToContainer=cr.type_applySolToContainer,P.getInstanceByIID=cr.type_getInstanceByIID,P.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),P.any_cell_changed=!0,P.any_instance_parallaxed=!1,P.extra={},P.toString=cr.type_toString,P.behaviors=[],r=0,s=o[8].length;r<s;r++){h=o[8][r];var R=this.GetObjectReference(h[1]),B=null;for(n=0,a=this.behaviors.length;n<a;n++)if(this.behaviors[n]instanceof R){B=this.behaviors[n];break}B||((B=new R(this)).my_types=[],B.my_instances=new cr.ObjectSet,B.onCreate&&B.onCreate(),cr.seal(B),this.behaviors.push(B),cr.behaviors.solid&&B instanceof cr.behaviors.solid&&(this.solidBehavior=B),cr.behaviors.jumpthru&&B instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=B),cr.behaviors.shadowcaster&&B instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=B)),-1===B.my_types.indexOf(P)&&B.my_types.push(P);var k=new B.Type(B,P);k.name=h[0],k.sid=h[2],k.onCreate(),cr.seal(k),P.behaviors.push(k)}for(P.global=o[9],P.isOnLoaderLayout=o[10],P.effect_types=[],r=0,s=o[12].length;r<s;r++)P.effect_types.push({id:o[12][r][0],name:o[12][r][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:r});if(P.tile_poly_data=o[13],this.uses_loader_layout&&!P.is_family&&!P.isOnLoaderLayout&&p.is_world||(P.onCreate(),cr.seal(P)),P.name&&(this.types[P.name]=P),this.types_by_index.push(P),p.singleglobal){var O=new p.Instance(P);O.uid=this.next_uid++,O.puid=this.next_puid++,O.iid=0,O.get_iid=cr.inst_get_iid,O.toString=cr.inst_toString,O.properties=o[14],O.onCreate(),cr.seal(O),P.instances.push(O),this.objectsByUid[O.uid.toString()]=O}}for(e=0,i=f[4].length;e<i;e++){var I,F=f[4][e],L=this.types_by_index[F[0]];for(r=1,s=F.length;r<s;r++)(I=this.types_by_index[F[r]]).families.push(L),L.members.push(I)}for(e=0,i=f[28].length;e<i;e++){var M=f[28][e],D=[];for(r=0,s=M.length;r<s;r++)D.push(this.types_by_index[M[r]]);for(r=0,s=D.length;r<s;r++)D[r].is_contained=!0,D[r].container=D}if(this.family_count>0)for(e=0,i=this.types_by_index.length;e<i;e++)if(!(l=this.types_by_index[e]).is_family&&l.families.length){l.family_var_map=new Array(this.family_count),l.family_beh_map=new Array(this.family_count),l.family_fx_map=new Array(this.family_count);var N=[],j=0,U=0,W=0;for(r=0,s=l.families.length;r<s;r++)for(c=l.families[r],l.family_var_map[c.family_index]=j,j+=c.vars_count,l.family_beh_map[c.family_index]=U,U+=c.behs_count,l.family_fx_map[c.family_index]=W,W+=c.fx_count,n=0,a=c.effect_types.length;n<a;n++)N.push(cr.shallowCopy({},c.effect_types[n]));for(l.effect_types=N.concat(l.effect_types),r=0,s=l.effect_types.length;r<s;r++)l.effect_types[r].index=r}for(e=0,i=f[5].length;e<i;e++){o=f[5][e];var V=new cr.layout(this,o);cr.seal(V),this.layouts[V.name]=V,this.layouts_by_index.push(V)}for(e=0,i=f[6].length;e<i;e++){o=f[6][e];var z=new cr.eventsheet(this,o);cr.seal(z),this.eventsheets[z.name]=z,this.eventsheets_by_index.push(z)}for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].postInit();for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].updateDeepIncludes();for(e=0,i=this.triggers_to_postinit.length;e<i;e++)this.triggers_to_postinit[e].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=f[7],this.files_subfolder=f[8],this.pixel_rounding=f[9],this.aspect_scale=1,this.enableWebGL=f[13],this.linearSampling=f[14],this.clearBackground=f[15],this.versionstr=f[16],this.useHighDpi=f[17],this.orientations=f[20],this.autoLockOrientation=this.orientations>0,this.pauseOnBlur=f[22],this.wantFullscreenScalingQuality=f[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=f[24],this.preloadSounds=f[25],this.projectName=f[26],this.enableFrontToBack=f[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()};var r=!1,s=0,n=[];e.prototype.queueImageLoad=function(t,e){var i=this,r=function(){s--,i.maybeLoadNextImages()};t.addEventListener("load",r),t.addEventListener("error",r),n.push([t,e]),this.maybeLoadNextImages()},e.prototype.maybeLoadNextImages=function(){for(var t;n.length&&s<100;)s++,t=n.shift(),this.setImageSrc(t[0],t[1])},e.prototype.waitForImageLoad=function(t,e){t.cocoonLazyLoad=!0,t.onerror=function(e){t.c2error=!0,r=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",e)},this.isEjecta?t.src=e:t.src||("undefined"!=typeof XAPKReader?XAPKReader.get(e,(function(e){t.src=e}),(function(i){t.c2error=!0,r=!0,console&&console.error&&console.error("Error extracting image '"+e+"' from expansion file: ",i)})):(t.crossOrigin="anonymous",this.queueImageLoad(t,e))),this.wait_for_textures.push(t)},e.prototype.findWaitingTexture=function(t){var e,i;for(e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null};var a=0,o=!1;e.prototype.getready=function(){this.audioInstance&&(a=this.audioInstance.setPreloadList(this.audio_to_preload))},e.prototype.areAllTexturesAndSoundsLoaded=function(){var t,e,i,r=a,s=0,n=0,h=!0;for(t=0,e=this.wait_for_textures.length;t<e;t++){var l=(i=this.wait_for_textures[t]).cr_filesize;(!l||l<=0)&&(l=5e4),r+=l,i.src&&(i.complete||i.loaded)&&!i.c2error?s+=l:h=!1}return h&&this.preloadSounds&&this.audioInstance&&(o||(this.audioInstance.startPreloads(),o=!0),s+=n=this.audioInstance.getPreloadedSize(),n<a&&(h=!1)),this.progress=0==r?1:s/r,h};var h=!1;e.prototype.go=function(){if(this.ctx||this.glwrap){var e=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var i=window.innerWidth,s=window.innerHeight;this.lastWindowWidth===i&&this.lastWindowHeight===s||this.setSize(i,s),this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||h))this.go_loading_finished();else{var a=Date.now()-this.start_time;if(e){var o=this.width,l=this.height,c=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||a>=500&&this.last_progress!=this.progress)){e.clearRect(0,0,o,l);var u,p=o/2,d=l/2,f=0===this.loaderstyle&&this.loaderlogos.logo.complete,g=40*c,_=0,y=80*c;if(f){var m=this.loaderlogos.logo;g=(y=m.width*c)/2,_=(u=m.height*c)/2,e.drawImage(m,cr.floor(p-g),cr.floor(d-_),y,u)}if(this.loaderstyle<=1)d+=_+(f?12*c:0),p-=g,p=cr.floor(p)+.5,d=cr.floor(d)+.5,e.fillStyle=r?"red":"DodgerBlue",e.fillRect(p,d,Math.floor(y*this.progress),6*c),e.strokeStyle="black",e.strokeRect(p,d,y,6*c),e.strokeStyle="white",e.strokeRect(p-1*c,d-1*c,y+2*c,8*c);else if(2===this.loaderstyle){e.font=this.isEjecta?"12pt ArialMT":"12pt Arial",e.fillStyle=r?"#f00":"#999",e.textBaseLine="middle";var v=Math.round(100*this.progress)+"%",w=e.measureText?e.measureText(v):null,b=w?w.width:0;e.fillText(v,p-b/2,d)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(e),void(t?t((function(){n.go()})):setTimeout((function(){n.go()}),16))}setTimeout((function(){n.go()}),this.isCocoonJs?10:100)}}};var l=-1,c="undefined"==typeof cr_is_preview?200:0,u=!0,p=!1,d=0,f=0,g="undefined"==typeof cr_is_preview?3e3:0,_=null,y=null,m=0;function v(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}e.prototype.draw_c2_splash_loader=function(t){if(!h){for(var e=Math.ceil(this.width),i=Math.ceil(this.height),s=(this.devicePixelRatio,this.loaderlogos.logo),n=this.loaderlogos.powered,a=this.loaderlogos.website,o=0;o<4;++o)if(!s[o].complete||!n[o].complete||!a[o].complete)return;0===m&&(l=Date.now());var w,b,x=Date.now(),S=!1,T=t;u||p?(t.clearRect(0,0,e,i),function(t,e){_&&_.width===t&&_.height===e||((_=document.createElement("canvas")).width=t,_.height=e,y=_.getContext("2d"))}(e,i),T=y,S=!0,u&&1===m&&(l=Date.now())):t.globalAlpha=1,T.fillStyle="#333333",T.fillRect(0,0,e,i),this.cssHeight>256?(b=.25*(w=cr.clamp(.22*i,105,.6*e)),T.drawImage(v(n,w),.5*e-w/2,.2*i-b/2,w,b),b=w=Math.min(.395*i,.95*e),T.drawImage(v(s,w),.5*e-w/2,.485*i-b/2,w,b),b=.25*(w=cr.clamp(.22*i,105,.6*e)),T.drawImage(v(a,w),.5*e-w/2,.868*i-b/2,w,b),T.fillStyle="#3C3C3C",w=e,b=Math.max(.005*i,2),T.fillRect(0,.8*i-b/2,w,b),T.fillStyle=r?"red":"#E0FF65",w=e*this.progress,T.fillRect(.5*e-w/2,.8*i-b/2,w,b)):(b=w=.55*i,T.drawImage(v(s,w),.5*e-w/2,.45*i-b/2,w,b),T.fillStyle="#3C3C3C",w=e,b=Math.max(.005*i,2),T.fillRect(0,.85*i-b/2,w,b),T.fillStyle=r?"red":"#E0FF65",w=e*this.progress,T.fillRect(.5*e-w/2,.85*i-b/2,w,b)),S&&(u?t.globalAlpha=0===m?0:Math.min((x-l)/300,1):p&&(t.globalAlpha=Math.max(1-(x-f)/300,0)),t.drawImage(_,0,0,e,i)),u&&x-l>=300&&m>=2&&(u=!1,d=x),!u&&x-d>=g&&!p&&this.progress>=1&&(p=!0,f=x),(p&&x-f>=300+c||"undefined"!=typeof cr_is_preview&&this.progress>=1&&Date.now()-l<500)&&(h=!0,u=!1,p=!1,_=null,y=null,this.loaderlogos=null),++m}},e.prototype.go_loading_finished=function(){var t,e,i;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();if(this.fullscreen_mode>=2){var r=this.original_width/this.original_height,s=this.width/this.height;2!==this.fullscreen_mode&&s>r||2===this.fullscreen_mode&&s<r?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width}for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},e.prototype.tick=function(e,i,r){if(this.running_layout){var s=cr.performance_now(),n=s;if(r||!this.isSuspended||e){e||(t?this.raf_id=t(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var a=i||s,o=this.fullscreen_mode,h=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if((h||this.isNodeFullscreen)&&this.fullscreen_scaling>0&&(o=this.fullscreen_scaling),o>0){var l=window.innerWidth,c=window.innerHeight;this.lastWindowWidth===l&&this.lastWindowHeight===c||this.setSize(l,c)}if(this.isDomFree||(h?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading){var u=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,u&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())}this.logic(a),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||e||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-n}}},e.prototype.logic=function(t){var e,i,r,s,n,a,o,h;t-this.last_fps_time>=1e3&&(this.last_fps_time+=1e3,t-this.last_fps_time>=1e3&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var l=0;if(0!==this.last_tick_time){var c=t-this.last_tick_time;c<0&&(c=0),l=c/1e3,this.dt1=l,this.dt1>.5?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(l);var u=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;if(this.fullscreen_mode>=2||u&&this.fullscreen_scaling>0){var p=this.original_width/this.original_height,d=this.width/this.height,f=this.fullscreen_mode;u&&this.fullscreen_scaling>0&&(f=this.fullscreen_scaling),this.aspect_scale=2!==f&&d>p||2===f&&d<p?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var g=this.objects_to_pretick.valuesRef();for(e=0,i=g.length;e<i;e++)g[e].pretick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(o=this.types_by_index[e]).is_family&&(o.behaviors.length||o.families.length))for(r=0,s=o.instances.length;r<s;r++)for(n=0,a=(_=o.instances[r]).behavior_insts.length;n<a;n++)_.behavior_insts[n].tick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(o=this.types_by_index[e]).is_family&&(o.behaviors.length||o.families.length))for(r=0,s=o.instances.length;r<s;r++)for(n=0,a=(_=o.instances[r]).behavior_insts.length;n<a;n++)(h=_.behavior_insts[n]).posttick&&h.posttick();for(e=0,i=(g=this.objects_to_tick.valuesRef()).length;e<i;e++)g[e].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),e=0;this.changelayout&&e++<10;)this.doChangeLayout(this.changelayout);for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,e=0,i=this.types_by_index.length;e<i;e++)if(!(o=this.types_by_index[e]).is_family&&(o.behaviors.length||o.families.length))for(r=0,s=o.instances.length;r<s;r++){var _;for(n=0,a=(_=o.instances[r]).behavior_insts.length;n<a;n++)(h=_.behavior_insts[n]).tick2&&h.tick2()}for(e=0,i=(g=this.objects_to_tick2.valuesRef()).length;e<i;e++)g[e].tick2();this.isInOnDestroy--},e.prototype.onWindowBlur=function(){var t,e,i,r,s,n,a,o,h;for(t=0,e=this.types_by_index.length;t<e;t++)if(!(a=this.types_by_index[t]).is_family)for(i=0,r=a.instances.length;i<r;i++)if((o=a.instances[i]).onWindowBlur&&o.onWindowBlur(),o.behavior_insts)for(s=0,n=o.behavior_insts.length;s<n;s++)(h=o.behavior_insts[s]).onWindowBlur&&h.onWindowBlur()},e.prototype.doChangeLayout=function(t){var e,i,r,s=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(r=this.types_by_index[e]).is_family||!r.unloadTextures||r.global&&0!==r.instances.length||-1!==t.initial_types.indexOf(r)||r.unloadTextures();s==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},e.prototype.runLayoutChangeMethods=function(t){var e,i,r,s,n,a,o,h,l,c;for(e=0,i=this.behaviors.length;e<i;e++)r=this.behaviors[e],t?r.onBeforeLayoutChange&&r.onBeforeLayoutChange():r.onLayoutChange&&r.onLayoutChange();for(e=0,i=this.types_by_index.length;e<i;e++)if((s=this.types_by_index[e]).global||s.plugin.singleglobal)for(n=0,a=s.instances.length;n<a;n++)if(o=s.instances[n],t?o.onBeforeLayoutChange&&o.onBeforeLayoutChange():o.onLayoutChange&&o.onLayoutChange(),o.behavior_insts)for(h=0,l=o.behavior_insts.length;h<l;h++)c=o.behavior_insts[h],t?c.onBeforeLayoutChange&&c.onBeforeLayoutChange():c.onLayoutChange&&c.onLayoutChange()},e.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},e.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},e.prototype.tickMe=function(t){this.objects_to_tick.add(t)},e.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},e.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},e.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},e.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},e.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},e.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},e.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},e.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},e.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var w=[];e.prototype.DestroyInstance=function(t){var e,i,r=t.type.name,s=null;if(this.deathRow.hasOwnProperty(r)){if((s=this.deathRow[r]).contains(t))return}else s=w.length?w.pop():new cr.ObjectSet,this.deathRow[r]=s;if(s.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&s.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},e.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,r,s,n;for(this.isInClearDeathRow=!0,i=0,s=this.createRow.length;i<s;++i)for((e=(t=this.createRow[i]).type).instances.push(t),r=0,n=e.families.length;r<n;++r)e.families[r].instances.push(t),e.families[r].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},e.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},e.prototype.ClearDeathRowForType=function(t){var e,i,r,s,n,a,o,h,l=t.valuesRef(),c=l[0].type;for(cr.arrayRemoveAllFromObjectSet(c.instances,t),c.stale_iids=!0,0===c.instances.length&&(c.any_instance_parallaxed=!1),e=0,i=c.families.length;e<i;++e)a=c.families[e],cr.arrayRemoveAllFromObjectSet(a.instances,t),a.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((n=this.system.waits[e]).sols.hasOwnProperty(c.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[c.index].insts,t),!c.is_family)for(r=0,s=c.families.length;r<s;++r)a=c.families[r],n.sols.hasOwnProperty(a.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[a.index].insts,t);var u,p=l[0].layer;if(p){if(p.useRenderCells)for(e=0,i=(o=p.instances).length;e<i;++e)h=o[e],t.contains(h)&&(h.update_bbox(),p.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<l.length;++e)this.ClearDeathRowForSingleInstance(l[e],c);(u=t).clear(),w.push(u),this.redraw=!0},e.prototype.ClearDeathRowForSingleInstance=function(t,e){var i,r,s;for(i=0,r=this.destroycallbacks.length;i<r;++i)this.destroycallbacks[i](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var n=t.layer;if(n&&n.removeFromInstanceList(t,!0),t.behavior_insts)for(i=0,r=t.behavior_insts.length;i<r;++i)(s=t.behavior_insts[i]).onDestroy&&s.onDestroy(),s.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},e.prototype.createInstance=function(t,e,i,r){if(t.is_family){var s=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[s],e,i,r)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,r,!1):null};var b=[];e.prototype.createInstanceFromInit=function(t,e,i,r,s,n){var a,o,h,l,c;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,f=e;for(p||(e=null),u.deadCache.length?((d=u.deadCache.pop()).recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u)).recycled=!1,!i||n||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],this.objectsByUid[d.uid.toString()]=d,d.puid=this.next_puid++,d.iid=u.instances.length,a=0,o=this.createRow.length;a<o;++a)this.createRow[a].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString;var g,_=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},"undefined"!=typeof cr_is_preview)for(d.instance_var_names=[],d.instance_var_names.length=_.length,a=0,o=_.length;a<o;a++)d.instance_var_names[a]=_[a][1];d.instance_vars=[],d.instance_vars.length=_.length}for(a=0,o=_.length;a<o;a++)d.instance_vars[a]=_[a][0];if(p){var y=t[0];if(d.x=cr.is_undefined(r)?y[0]:r,d.y=cr.is_undefined(s)?y[1]:s,d.z=y[2],d.width=y[3],d.height=y[4],d.depth=y[5],d.angle=y[6],d.opacity=y[7],d.hotspotX=y[8],d.hotspotY=y[9],d.blend_mode=y[10],c=y[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=c),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(a=0,o=y[12].length;a<o;a++)for(h=0,l=y[12][a].length;h<l;h++)d.effect_params[a][h]=y[12][a][h];d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=y[12].slice(0),a=0,o=d.effect_params.length;a<o;a++)d.effect_params[a]=y[12][a].slice(0);d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,14===y.length&&(d.tilemap_exists=!0,d.tilemap_width=y[13][0],d.tilemap_height=y[13][1],d.tilemap_data=y[13][2]),a=0,o=u.effect_types.length;a<o;a++)d.active_effect_flags[a]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,d.earlyz_index=0,void 0===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(b),a=0,o=u.families.length;a<o;a++)b.push.apply(b,u.families[a].behaviors);if(b.push.apply(b,u.behaviors),d.recycled)for(a=0,o=b.length;a<o;a++){var m=b[a];for((v=d.behavior_insts[a]).recycled=!0,m.behavior.Instance.call(v,m,d),h=0,l=(g=t[4][a]).length;h<l;h++)v.properties[h]=g[h];v.onCreate(),m.behavior.my_instances.add(d)}else for(d.behavior_insts=[],a=0,o=b.length;a<o;a++){var v;(v=new(m=b[a]).behavior.Instance(m,d)).recycled=!1,v.properties=t[4][a].slice(0),v.onCreate(),cr.seal(v),d.behavior_insts.push(v),m.behavior.my_instances.add(d)}if(g=t[5],d.recycled)for(a=0,o=g.length;a<o;a++)d.properties[a]=g[a];else d.properties=g.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!n){for(a=0,o=u.container.length;a<o;a++)if(u.container[a]!==u){if(!u.container[a].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[a].default_instance,f,!1,p?d.x:r,p?d.y:s,!0))}for(a=0,o=d.siblings.length;a<o;a++)for(d.siblings[a].siblings.push(d),h=0;h<o;h++)a!==h&&d.siblings[a].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),a=0,o=d.behavior_insts.length;a<o;a++)d.behavior_insts[a].postCreate&&d.behavior_insts[a].postCreate();return d},e.prototype.getLayerByName=function(t){var e,i;for(e=0,i=this.running_layout.layers.length;e<i;e++){var r=this.running_layout.layers[e];if(cr.equals_nocase(r.name,t))return r}return null},e.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},e.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},e.prototype.clearSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},e.prototype.pushCleanSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},e.prototype.pushCopySol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCopySol()},e.prototype.popSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].popSol()},e.prototype.updateAllCells=function(t){if(t.any_cell_changed){var e,i,r=t.instances;for(e=0,i=r.length;e<i;++e)r[e].update_collision_cell();var s=this.createRow;for(e=0,i=s.length;e<i;++e)s[e].type===t&&s[e].update_collision_cell();t.any_cell_changed=!1}},e.prototype.getCollisionCandidates=function(t,e,i,r){var s,n,a,o=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(s=0,n=e.members.length;s<n;++s)a=e.members[s],o||a.any_instance_parallaxed?cr.appendArray(r,a.instances):(this.updateAllCells(a),a.collision_grid.queryRange(i,r));else o||e.any_instance_parallaxed?cr.appendArray(r,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,r))},e.prototype.getTypesCollisionCandidates=function(t,e,i,r){var s,n;for(s=0,n=e.length;s<n;++s)this.getCollisionCandidates(t,e[s],i,r)},e.prototype.getSolidCollisionCandidates=function(t,e,i){var r=this.getSolidBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},e.prototype.getJumpthruCollisionCandidates=function(t,e,i){var r=this.getJumpthruBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},e.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,r){var s,n,a,o,h,l,c,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(r||(u.select_all=!1,cr.clearArray(u.instances)),s=0,o=t.instances.length;s<o;s++)if((a=t.instances[s]).update_bbox(),h=a.layer.canvasToLayer(e,i,!0),l=a.layer.canvasToLayer(e,i,!1),a.contains_pt(h,l)){if(r)return!1;u.instances.push(a)}else p&&u.else_instances.push(a);else{for(n=0,s=0,o=(c=p?u.else_instances:u.instances).length;s<o;s++)if((a=c[s]).update_bbox(),h=a.layer.canvasToLayer(e,i,!0),l=a.layer.canvasToLayer(e,i,!1),a.contains_pt(h,l)){if(r)return!1;p?u.instances.push(a):(u.instances[n]=u.instances[s],n++)}r||(c.length=n)}return t.applySolToContainer(),!!r||u.hasObjects()},e.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,r,s,n,a,o,h,l,c,u,p=t.layer,d=e.layer;if(p!==d&&(p.parallaxX!==d.parallaxX||d.parallaxY!=d.parallaxY||p.scale!==d.scale||p.angle!==d.angle||p.zoomRate!==d.zoomRate)){for(h=t.collision_poly&&!t.collision_poly.is_empty(),l=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),c=this.temp_poly,l?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,r=c.pts_count;i<r;i++)n=(s=2*i)+1,a=c.pts_cache[s],o=c.pts_cache[n],c.pts_cache[s]=p.layerToCanvas(a+t.x,o+t.y,!0),c.pts_cache[n]=p.layerToCanvas(a+t.x,o+t.y,!1);for(c.update_bbox(),i=0,r=u.pts_count;i<r;i++)n=(s=2*i)+1,a=u.pts_cache[s],o=u.pts_cache[n],u.pts_cache[s]=d.layerToCanvas(a+e.x,o+e.y,!0),u.pts_cache[n]=d.layerToCanvas(a+e.x,o+e.y,!1);return u.update_bbox(),c.intersects_poly(u,0,0)}return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),l=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!l||(h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),c=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),c=this.temp_poly),l?(e.collision_poly.cache_poly(e.width,e.height,e.angle),u=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly),c.intersects_poly(u,e.x-t.x,e.y-t.y))))))};var x=new cr.quad,S=new cr.rect(0,0,0,0),T=[];e.prototype.testTilemapOverlap=function(t,e){var i,r,s,n,a=e.bbox,o=t.x,h=t.y;t.getCollisionRectCandidates(a,T);var l=T,c=e.collision_poly&&!e.collision_poly.is_empty();for(i=0,r=l.length;i<r;++i)if(n=(s=l[i]).rc,a.intersects_rect_off(n,o,h)&&(x.set_from_rect(n),x.offset(o,h),x.intersects_quad(e.bquad)))if(c){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),s.poly){if(s.poly.intersects_poly(e.collision_poly,e.x-(o+n.left),e.y-(h+n.top)))return cr.clearArray(T),!0}else if(this.temp_poly.set_from_quad(x,0,0,n.right-n.left,n.bottom-n.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(T),!0}else{if(!s.poly)return cr.clearArray(T),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),s.poly.intersects_poly(this.temp_poly,-(o+n.left),-(h+n.top)))return cr.clearArray(T),!0}return cr.clearArray(T),!1},e.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,T);var i,r,s,n,a=T,o=e.x,h=e.y;for(i=0,r=a.length;i<r;++i)if(n=(s=a[i]).rc,t.intersects_rect_off(n,o,h)){if(!s.poly)return cr.clearArray(T),!0;if(this.temp_poly.set_from_rect(t,0,0),s.poly.intersects_poly(this.temp_poly,-(o+n.left),-(h+n.top)))return cr.clearArray(T),!0}return cr.clearArray(T),!1}return x.set_from_rect(t),!!e.bquad.intersects_quad(x)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),x.offset(-t.left,-t.top),this.temp_poly.set_from_quad(x,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},e.prototype.testSegmentOverlap=function(t,e,i,r,s){if(!s||!s.collisionsEnabled)return!1;s.update_bbox();s.layer;if(S.set(cr.min(t,i),cr.min(e,r),cr.max(t,i),cr.max(e,r)),!s.bbox.intersects_rect(S))return!1;if(s.tilemap_exists){s.getCollisionRectCandidates(S,T);var n,a,o,h,l=T,c=s.x,u=s.y;for(n=0,a=l.length;n<a;++n)if(h=(o=l[n]).rc,S.intersects_rect_off(h,c,u)&&(x.set_from_rect(h),x.offset(c,u),x.intersects_segment(t,e,i,r))){if(!o.poly)return cr.clearArray(T),!0;if(o.poly.intersects_segment(c+h.left,u+h.top,t,e,i,r))return cr.clearArray(T),!0}return cr.clearArray(T),!1}return!!s.bquad.intersects_segment(t,e,i,r)&&(!(s.collision_poly&&!s.collision_poly.is_empty())||(s.collision_poly.cache_poly(s.width,s.height,s.angle),s.collision_poly.intersects_segment(s.x,s.y,t,e,i,r)))},e.prototype.typeHasBehavior=function(t,e){if(!e)return!1;var i,r,s,n,a;for(i=0,r=t.behaviors.length;i<r;i++)if(t.behaviors[i].behavior instanceof e)return!0;if(!t.is_family)for(i=0,r=t.families.length;i<r;i++)for(s=0,n=(a=t.families[i]).behaviors.length;s<n;s++)if(a.behaviors[s].behavior instanceof e)return!0;return!1},e.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},e.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},e.prototype.getSolidBehavior=function(){return this.solidBehavior},e.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var C=[];e.prototype.testOverlapSolid=function(t){var e,i,r;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,C),e=0,i=C.length;e<i;++e)if((r=C[e]).extra.solidEnabled&&this.testOverlap(t,r))return cr.clearArray(C),r;return cr.clearArray(C),null},e.prototype.testRectOverlapSolid=function(t){var e,i,r;for(this.getSolidCollisionCandidates(null,t,C),e=0,i=C.length;e<i;++e)if((r=C[e]).extra.solidEnabled&&this.testRectOverlap(t,r))return cr.clearArray(C),r;return cr.clearArray(C),null};var E=[];e.prototype.testOverlapJumpThru=function(t,e){var i,r,s,n=null;for(e&&(n=E,cr.clearArray(n)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,C),i=0,r=C.length;i<r;++i)if((s=C[i]).extra.jumpthruEnabled&&this.testOverlap(t,s)){if(!e)return cr.clearArray(C),s;n.push(s)}return cr.clearArray(C),n},e.prototype.pushOutSolid=function(t,e,i,r,s,n){var a,o=r||50,h=t.x,l=t.y,c=null,u=null;for(a=0;a<o;a++)if(t.x=h+e*a,t.y=l+i*a,t.set_bbox_changed(),!this.testOverlap(t,c)&&((c=this.testOverlapSolid(t))&&(u=c),!c&&(s&&(c=n?this.testOverlap(t,n)?n:null:this.testOverlapJumpThru(t))&&(u=c),!c)))return u&&this.pushInFractional(t,e,i,u,16),!0;return t.x=h,t.y=l,t.set_bbox_changed(),!1},e.prototype.pushOutSolidAxis=function(t,e,i,r){r=r||50;var s,n,a,o=t.x,h=t.y,l=null,c=null;for(s=0;s<r;++s)for(n=0;n<2;++n)if(a=2*n-1,t.x=o+e*s*a,t.y=h+i*s*a,t.set_bbox_changed(),!this.testOverlap(t,l)){if(!(l=this.testOverlapSolid(t)))return c&&this.pushInFractional(t,e*a,i*a,c,16),!0;c=l}return t.x=o,t.y=h,t.set_bbox_changed(),!1},e.prototype.pushOut=function(t,e,i,r,s){var n,a=r||50,o=t.x,h=t.y;for(n=0;n<a;n++)if(t.x=o+e*n,t.y=h+i*n,t.set_bbox_changed(),!this.testOverlap(t,s))return!0;return t.x=o,t.y=h,t.set_bbox_changed(),!1},e.prototype.pushInFractional=function(t,e,i,r,s){for(var n,a=2,o=!1,h=!1,l=t.x,c=t.y;a<=s;)n=1/a,a*=2,t.x+=e*n*(o?1:-1),t.y+=i*n*(o?1:-1),t.set_bbox_changed(),this.testOverlap(t,r)?(o=!0,h=!0):(o=!1,h=!1,l=t.x,c=t.y);h&&(t.x=l,t.y=c,t.set_bbox_changed())},e.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,r=0,s=t.x,n=t.y,a=0,o=0,h=0,l=this.testOverlapSolid(t);if(!l)return!0;for(;r<=i;){switch(a){case 0:o=0,h=-1,r++;break;case 1:o=1,h=-1;break;case 2:o=1,h=0;break;case 3:o=1,h=1;break;case 4:o=0,h=1;break;case 5:o=-1,h=1;break;case 6:o=-1,h=0;break;case 7:o=-1,h=-1}if(a=(a+1)%8,t.x=cr.floor(s+o*r),t.y=cr.floor(n+h*r),t.set_bbox_changed(),!this.testOverlap(t,l)&&!(l=this.testOverlapSolid(t)))return!0}return t.x=s,t.y=n,t.set_bbox_changed(),!1},e.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},e.prototype.addRegisteredCollisionCandidates=function(t,e,i){var r,s,n,a;for(r=0,s=this.registered_collisions.length;r<s;++r){if((n=this.registered_collisions[r])[0]===t)a=n[1];else{if(n[1]!==t)continue;a=n[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(a.type!==e)continue;-1===i.indexOf(a)&&i.push(a)}},e.prototype.checkRegisteredCollision=function(t,e){var i,r,s;for(i=0,r=this.registered_collisions.length;i<r;i++)if((s=this.registered_collisions[i])[0]===t&&s[1]===e||s[0]===e&&s[1]===t)return!0;return!1},e.prototype.calculateSolidBounceAngle=function(t,e,i,r){var s=t.x,n=t.y,a=cr.max(10,cr.distanceTo(e,i,s,n)),o=cr.angleTo(e,i,s,n),h=r||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(o+cr.PI);var l,c,u,p,d=h,f=cr.to_radians(5);for(l=1;l<36;l++)if(c=o-l*f,t.x=e+Math.cos(c)*a,t.y=i+Math.sin(c)*a,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=r?null:this.testOverlapSolid(t))){u=c;break}36===l&&(u=cr.clamp_angle(o+cr.PI));d=h;for(l=1;l<36;l++)if(c=o+l*f,t.x=e+Math.cos(c)*a,t.y=i+Math.sin(c)*a,t.set_bbox_changed(),!this.testOverlap(t,d)&&!(d=r?null:this.testOverlapSolid(t))){p=c;break}if(36===l&&(p=cr.clamp_angle(o+cr.PI)),t.x=s,t.y=n,t.set_bbox_changed(),p===u)return p;var g,_=cr.angleDiff(p,u)/2;g=cr.angleClockwise(p,u)?cr.clamp_angle(u+_+cr.PI):cr.clamp_angle(p+_);var y=Math.cos(o),m=Math.sin(o),v=Math.cos(g),w=Math.sin(g),b=y*v+m*w,x=y-2*b*v,S=m-2*b*w;return cr.angleTo(0,0,x,S)};var A=-1;function P(){try{return!!window.indexedDB}catch(t){return!1}}function R(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function B(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():window.location.search.indexOf("continuous")>-1?window.location.reload(!0):window.location=window.location+"?continuous"}function k(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}e.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var r=this.running_layout.event_sheet;if(!r)return!1;var s,n,a,o=!1;A++;var h=r.deep_includes;for(n=0,a=h.length;n<a;++n)s=this.triggerOnSheet(t,e,h[n],i),o=o||s;return s=this.triggerOnSheet(t,e,r,i),A--,o=o||s},e.prototype.triggerOnSheet=function(t,e,i,r){var s,n,a,o,h=!1;if(e)for(a=this.triggerOnSheetForTypeName(t,e,e.type.name,i,r),h=h||a,s=0,n=(o=e.type.families).length;s<n;++s)a=this.triggerOnSheetForTypeName(t,e,o[s].name,i,r),h=h||a;else a=this.triggerOnSheetForTypeName(t,e,"system",i,r),h=h||a;return h},e.prototype.triggerOnSheetForTypeName=function(t,e,i,r,s){var n,a,o,h,l=!1,c=!1,u=void 0!==s,p=(u?r.fasttriggers:r.triggers)[i];if(!p)return l;var d,f=null;for(n=0,a=p.length;n<a;++n)if(p[n].method==t){f=p[n].evs;break}if(!f)return l;if(!(d=u?f[s]:f))return null;for(n=0,a=d.length;n<a;n++)o=d[n][0],h=d[n][1],c=this.executeSingleTrigger(e,i,o,h),l=l||c;return l},e.prototype.executeSingleTrigger=function(t,e,i,r){var s,n,a=!1;this.trigger_depth++;var o=this.getCurrentEventStack().current_event;o&&this.pushCleanSol(o.solModifiersIncludingParents);var h=this.trigger_depth>1;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var l=this.pushEventStack(i);if(l.current_event=i,t){var c=this.types[e].getCurrentSol();c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=t,this.types[e].applySolToContainer()}var u=!0;if(i.parent){for(var p=l.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),s=0,n=p.length;s<n;s++)if(!p[s].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(r):i.run(),a=a||l.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),o&&this.popSol(o.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===A&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,a},e.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},e.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},e.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},e.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},e.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},e.prototype.popLocalVarStack=function(){this.localvar_stack_index--},e.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},e.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},e.prototype.popEventStack=function(){this.event_stack_index--},e.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},e.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},e.prototype.popLoopStack=function(){this.loop_stack_index--},e.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},e.prototype.getEventVariableByName=function(t,e){for(var i,r,s,n,a,o;e;){for(i=0,r=e.subevents.length;i<r;i++)if((o=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,o.name))return o;e=e.parent}for(i=0,r=this.eventsheets_by_index.length;i<r;i++)for(s=0,n=(a=this.eventsheets_by_index[i]).events.length;s<n;s++)if((o=a.events[s])instanceof cr.eventvariable&&cr.equals_nocase(t,o.name))return o;return null},e.prototype.getLayoutBySid=function(t){var e,i;for(e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},e.prototype.getObjectTypeBySid=function(t){var e,i;for(e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},e.prototype.getGroupBySid=function(t){var e,i;for(e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},e.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},e.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},e.prototype.handleSaveLoad=function(){var t=this,e=this.saveToSlot,i=this.lastSaveJson,r=this.loadFromSlot,s=!1;if(this.signalledContinuousPreview&&(s=!0,e="__c2_continuouspreview",this.signalledContinuousPreview=!1),e.length){if(this.ClearDeathRow(),i=this.saveToJSONString(),P()&&!this.isCocoonJs)!function(t,e,i,r){try{var s=indexedDB.open("_C2SaveStates");s.onupgradeneeded=R,s.onerror=r,s.onsuccess=function(s){var n=s.target.result;n.onerror=r,n.transaction(["saves"],"readwrite").objectStore("saves").put({slot:t,data:e}).onsuccess=i}}catch(t){r(t)}}(e,i,(function(){cr.logexport("Saved state to IndexedDB storage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",s&&B()}),(function(r){try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",s&&B()}catch(e){cr.logexport("Failed to save game state: "+r+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}}));else try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",i="",s&&B()}catch(e){cr.logexport("Error saving to WebStorage: "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(r.length){if(P()&&!this.isCocoonJs)!function(t,e,i){try{var r=indexedDB.open("_C2SaveStates");r.onupgradeneeded=R,r.onerror=i,r.onsuccess=function(r){var s=r.target.result;s.onerror=i;var n=s.transaction(["saves"]).objectStore("saves").get(t);n.onsuccess=function(t){n.result?e(n.result.data):e(null)}}}catch(t){i(t)}}(r,(function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}),(function(e){t.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}));else{try{this.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},e.prototype.saveToJSONString=function(){var t,e,i,r,s,n,a,o,h,l,c,u,p={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};for(t=0,e=this.types_by_index.length;t<e;t++)if(!(s=this.types_by_index[t]).is_family&&!this.typeHasNoSaveBehavior(s)){for(a={instances:[]},cr.hasAnyOwnProperty(s.extra)&&(a.ex=k(s.extra)),i=0,r=s.instances.length;i<r;i++)a.instances.push(this.saveInstanceToJSON(s.instances[i]));p.types[s.sid.toString()]=a}for(t=0,e=this.layouts_by_index.length;t<e;t++)n=this.layouts_by_index[t],p.layouts[n.sid.toString()]=n.saveToJSON();var d=p.events.groups;for(t=0,e=this.allGroups.length;t<e;t++)d[(o=this.allGroups[t]).sid.toString()]=this.groups_by_name[o.group_name].group_active;var f=p.events.cnds;for(u in this.cndsBySid)this.cndsBySid.hasOwnProperty(u)&&(h=this.cndsBySid[u],cr.hasAnyOwnProperty(h.extra)&&(f[u]={ex:k(h.extra)}));var g=p.events.acts;for(u in this.actsBySid)this.actsBySid.hasOwnProperty(u)&&(l=this.actsBySid[u],cr.hasAnyOwnProperty(l.extra)&&(g[u]={ex:k(l.extra)}));var _=p.events.vars;for(u in this.varsBySid)this.varsBySid.hasOwnProperty(u)&&((c=this.varsBySid[u]).is_constant||c.parent&&!c.is_static||(_[u]=c.data));return p.system=this.system.saveToJSON(),JSON.stringify(p)},e.prototype.refreshUidMap=function(){var t,e,i,r,s,n;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(r=0,s=i.instances.length;r<s;r++)n=i.instances[r],this.objectsByUid[n.uid.toString()]=n},e.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(e.version>1)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var r,s,n,a,o,h,l,c,u,p,d,f,g,_,y,m,v,w=i.running_layout;if(w!==this.running_layout.sid){var b=this.getLayoutBySid(w);if(!b)return;this.doChangeLayout(b)}var x=e.types;for(l in x)if(x.hasOwnProperty(l)){if(!(c=this.getObjectTypeBySid(parseInt(l,10)))||c.is_family||this.typeHasNoSaveBehavior(c))continue;for(x[l].ex?c.extra=x[l].ex:cr.wipe(c.extra),u=c.instances,p=x[l].instances,r=0,s=cr.min(u.length,p.length);r<s;r++)this.loadInstanceFromJSON(u[r],p[r]);for(r=p.length,s=u.length;r<s;r++)this.DestroyInstance(u[r]);for(r=u.length,s=p.length;r<s;r++)_=null,c.plugin.is_world&&!(_=this.running_layout.getLayerBySid(p[r].w.l))||(d=this.createInstanceFromInit(c.default_instance,_,!1,0,0,!0),this.loadInstanceFromJSON(d,p[r]));c.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var S=e.layouts;for(l in S)if(S.hasOwnProperty(l)){if(!(g=this.getLayoutBySid(parseInt(l,10))))continue;g.loadFromJSON(S[l])}var T=e.events.groups;for(l in T)T.hasOwnProperty(l)&&(y=this.getGroupBySid(parseInt(l,10)))&&this.groups_by_name[y.group_name]&&this.groups_by_name[y.group_name].setGroupActive(T[l]);var C=e.events.cnds;for(l in this.cndsBySid)this.cndsBySid.hasOwnProperty(l)&&(C.hasOwnProperty(l)?this.cndsBySid[l].extra=C[l].ex:this.cndsBySid[l].extra={});var E=e.events.acts;for(l in this.actsBySid)this.actsBySid.hasOwnProperty(l)&&(E.hasOwnProperty(l)?this.actsBySid[l].extra=E[l].ex:this.actsBySid[l].extra={});var A=e.events.vars;for(l in A)A.hasOwnProperty(l)&&this.varsBySid.hasOwnProperty(l)&&(this.varsBySid[l].data=A[l]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,r=0,s=this.fireOnCreateAfterLoad.length;r<s;++r)d=this.fireOnCreateAfterLoad[r],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),r=0,s=this.types_by_index.length;r<s;r++)if(!(c=this.types_by_index[r]).is_family&&!this.typeHasNoSaveBehavior(c))for(n=0,a=c.instances.length;n<a;n++){if(d=c.instances[n],c.is_contained)for(m=d.get_iid(),cr.clearArray(d.siblings),o=0,h=c.container.length;o<h;o++)c!==(v=c.container[o])&&d.siblings.push(v.instances[m]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(o=0,h=d.behavior_insts.length;o<h;o++)(f=d.behavior_insts[o]).afterLoad&&f.afterLoad()}return this.redraw=!0,!0},e.prototype.saveInstanceToJSON=function(t,e){var i,r,s,n,a,o=t.type,h=o.plugin,l={};if(e?l.c2=!0:l.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(l.ex=k(t.extra)),t.instance_vars&&t.instance_vars.length)for(l.ivs={},i=0,r=t.instance_vars.length;i<r;i++)l.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(s={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(s.a=t.angle),1!==t.opacity&&(s.o=t.opacity),.5!==t.hotspotX&&(s.hX=t.hotspotX),.5!==t.hotspotY&&(s.hY=t.hotspotY),0!==t.blend_mode&&(s.bm=t.blend_mode),t.visible||(s.v=t.visible),t.collisionsEnabled||(s.ce=t.collisionsEnabled),-1!==t.my_timescale&&(s.mts=t.my_timescale),o.effect_types.length)for(s.fx=[],i=0,r=o.effect_types.length;i<r;i++)a=o.effect_types[i],s.fx.push({name:a.name,active:t.active_effect_flags[a.index],params:t.effect_params[a.index]});l.w=s}if(t.behavior_insts&&t.behavior_insts.length)for(l.behs={},i=0,r=t.behavior_insts.length;i<r;i++)(n=t.behavior_insts[i]).saveToJSON&&(l.behs[n.type.sid.toString()]=n.saveToJSON());return t.saveToJSON&&(l.data=t.saveToJSON()),l},e.prototype.getInstanceVarIndexBySid=function(t,e){var i,r;for(i=0,r=t.instvar_sids.length;i<r;i++)if(t.instvar_sids[i]===e)return i;return-1},e.prototype.getBehaviorIndexBySid=function(t,e){var i,r;for(i=0,r=t.behavior_insts.length;i<r;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},e.prototype.loadInstanceFromJSON=function(t,e,i){var r,s,n,a,o,h,l,c,u,p,d,f=t.type,g=f.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),o=e.ivs)for(r in o)if(o.hasOwnProperty(r)){if((a=this.getInstanceVarIndexBySid(f,parseInt(r,10)))<0||a>=t.instance_vars.length)continue;null===(p=o[r])&&(p=NaN),t.instance_vars[a]=p}if(g.is_world){if(h=e.w,t.layer.sid!==h.l&&(d=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(d.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=d,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(s=0,n=h.fx.length;s<n;s++)(l=f.getEffectIndexByName(h.fx[s].name))<0||(t.active_effect_flags[l]=h.fx[s].active,t.effect_params[l]=h.fx[s].params);t.updateActiveEffects()}if(c=e.behs)for(r in c)if(c.hasOwnProperty(r)){if((u=this.getBehaviorIndexBySid(t,parseInt(r,10)))<0)continue;t.behavior_insts[u].loadFromJSON(c[r])}e.data&&t.loadFromJSON(e.data)},e.prototype.fetchLocalFileViaCordova=function(t,e,i){var r=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(r,(function(t){t.file(e,i)}),i)},e.prototype.fetchLocalFileViaCordovaAsText=function(t,e,i){this.fetchLocalFileViaCordova(t,(function(t){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=i,r.readAsText(t)}),i)};var O=[],I=0;e.prototype.maybeStartNextArrayBufferRead=function(){if(O.length&&!(I>=8)){I++;var t=O.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)}},e.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var r=this;O.push({filename:t,successCallback:function(t){I--,r.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){I--,r.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},e.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){this.fetchLocalFileViaCordova(t,(function(t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(t)}),i)},e.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){var r="",s=t.toLowerCase(),n=s.substr(s.length-4),a=s.substr(s.length-5);".mp4"===n?r="video/mp4":".webm"===a?r="video/webm":".m4a"===n?r="audio/mp4":".mp3"===n&&(r="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,(function(t){var i=new Blob([t],{type:r}),s=URL.createObjectURL(i);e(s)}),i)},e.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},e.prototype.setImageSrc=function(t,e){this.isWKWebView&&!this.isAbsoluteUrl(e)?this.fetchLocalFileViaCordovaAsURL(e,(function(e){t.src=e}),(function(t){alert("Failed to load image: "+t)})):t.src=e},e.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=e,cr.createRuntime=function(t){return new e(document.getElementById(t))},cr.createDCRuntime=function(t,i){return new e({dc:!0,width:t,height:i})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);var i=new e(t);return window.c2runtime=i,window.addEventListener("orientationchange",(function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)})),window.c2runtime.setSize(window.innerWidth,window.innerHeight),i},window.createEjectaRuntime=function(){var t=new e(document.getElementById("canvas"));return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime?window.c2runtime:null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){if(0!==t&&0!==e){var i=window.cr_getC2Runtime();i&&i.setSize(t,e)}},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,r,s=e[6];for(this.layers=[],this.initial_types=[],i=0,r=s.length;i<r;i++){var n=new cr.layer(this,s[i]);n.number=i,cr.seal(n),this.layers.push(n)}var a=e[7];for(this.initial_nonworld=[],i=0,r=a.length;i<r;i++){var o=a[i],h=this.runtime.types_by_index[o[1]];h.default_instance||(h.default_instance=o),this.initial_nonworld.push(o),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=e[8].length;i<r;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){var e,i,r;for(e=0,i=this.effect_types.length;e<i;e++)if((r=this.effect_types[e]).name===t)return r;return null};var e=[];function i(t,e){return t.zindex-e.zindex}var r=!0;t.prototype.startRunning=function(){var t,s,n,a,o,h,l,c,u,p,d,f,g,_;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,n=this.runtime.types_by_index.length;t<n;t++)if(!(o=this.runtime.types_by_index[t]).is_family)for(s=0,a=(h=o.instances).length;s<a;s++)if((c=h[s]).layer){var y=c.layer.number;y>=this.layers.length&&(y=this.layers.length-1),c.layer=this.layers[y],-1===c.layer.instances.indexOf(c)&&c.layer.instances.push(c),c.layer.zindices_stale=!0}if(!r)for(t=0,n=this.layers.length;t<n;++t)this.layers[t].instances.sort(i);for(cr.clearArray(e),this.boundScrolling(),t=0,n=this.layers.length;t<n;t++)(_=this.layers[t]).createInitialInstances(),_.updateViewport(null);var m=!1;if(!this.first_visit){for(f in this.persist_data)if(this.persist_data.hasOwnProperty(f)){if(!(o=this.runtime.getObjectTypeBySid(parseInt(f,10)))||o.is_family||!this.runtime.typeHasPersistBehavior(o))continue;for(t=0,n=(g=this.persist_data[f]).length;t<n;t++)_=null,o.plugin.is_world&&!(_=this.getLayerBySid(g[t].w.l))||(c=this.runtime.createInstanceFromInit(o.default_instance,_,!1,0,0,!0),this.runtime.loadInstanceFromJSON(c,g[t]),m=!0,e.push(c));cr.clearArray(g)}for(t=0,n=this.layers.length;t<n;t++)this.layers[t].instances.sort(i),this.layers[t].zindices_stale=!0}for(m&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<e.length;t++)if((c=e[t]).type.is_contained)for(u=c.get_iid(),s=0,a=c.type.container.length;s<a;s++)p=c.type.container[s],c.type!==p&&(p.instances.length>u?c.siblings.push(p.instances[u]):p.default_instance&&(d=this.runtime.createInstanceFromInit(p.default_instance,c.layer,!0,c.x,c.y,!0),this.runtime.ClearDeathRow(),p.updateIIDs(),c.siblings.push(d),e.push(d)));for(t=0,n=this.initial_nonworld.length;t<n;t++)l=this.initial_nonworld[t],(o=this.runtime.types_by_index[l[1]]).is_contained||(c=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,n=this.runtime.types_by_index.length;t<n;t++)!(p=this.runtime.types_by_index[t]).is_family&&p.instances.length&&p.preloadCanvas2D&&p.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,e);else for(t=0,n=e.length;t<n;t++)c=e[t],this.runtime.trigger(Object.getPrototypeOf(c.type.plugin).cnds.OnCreated,c);cr.clearArray(e),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){var t,e,i,r,s;for(t=0,e=0,i=this.initial_nonworld.length;t<i;t++)r=this.initial_nonworld[t],(s=this.runtime.types_by_index[r[1]]).global?s.is_contained||this.runtime.createInstanceFromInit(r,null,!0):(this.initial_nonworld[e]=r,e++);cr.truncateArray(this.initial_nonworld,e)},t.prototype.stopRunning=function(){var t,e,i,s,n,a,o;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,s=(n=this.layers[t].instances).length;i<s;i++)(a=n[i]).type.global||this.runtime.typeHasPersistBehavior(a.type)&&this.saveObjectToPersist(a);for(t=0,e=this.layers.length;t<e;t++){for(i=0,s=(n=this.layers[t].instances).length;i<s;i++)(a=n[i]).type.global||this.runtime.DestroyInstance(a);this.runtime.ClearDeathRow(),cr.clearArray(n),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((o=this.runtime.types_by_index[t]).global||o.plugin.is_world||o.plugin.singleglobal||o.is_family)){for(i=0,s=o.instances.length;i<s;i++)this.runtime.DestroyInstance(o.instances[i]);this.runtime.ClearDeathRow()}r=!1,this.runtime.isEndingLayout=!1};var s=new cr.rect(0,0,0,0);function n(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=o(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,r,s=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,r=s.length;i<r;i++){var n=s[i],a=this.runtime.types_by_index[n[1]];a.default_instance||(a.default_instance=n,a.default_layerindex=this.index),this.initial_instances.push(n),-1===this.layout.initial_types.indexOf(a)&&this.layout.initial_types.push(a)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=e[15].length;i<r;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}t.prototype.recreateInitialObjects=function(t,e,i,r,n){var a,o;for(s.set(e,i,r,n),a=0,o=this.layers.length;a<o;a++)this.layers[a].recreateInitialObjects(t,s)},t.prototype.draw=function(t){var e,i,r,s,n=t,a=!1,o=!this.runtime.fullscreenScalingQuality;for(o&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),a=!0),e=this.runtime.layout_canvas,n=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,a=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,a=!0),a&&this.runtime.setCtxImageSmoothingEnabled(n,this.runtime.linearSampling)),n.globalAlpha=1,n.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&n.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,r=this.layers.length;i<r;i++)(s=this.layers[i]).visible&&s.opacity>0&&11!==s.blend_mode&&(s.instances.length||!s.transparent)?s.draw(n):s.updateViewport(null);o&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;e>=0;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,r,s=this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(s?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(r=this.layers[e]).visible&&r.opacity>0&&(r.instances.length||!r.transparent)?r.drawGL(t):r.updateViewport(null);if(s)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var n=this.active_effect_types[0].index;t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[n]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else t.switchProgram(0);this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView();var a=this.runtime.width/2,o=this.runtime.height/2;t.quad(-a,o,a,o,a,-o,-a,-o),t.setTexture(null),t.setDepthTestEnabled(!0)}else this.renderEffectChain(t,null,null,null)},t.prototype.getRenderTarget=function(){return this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){var t,e,i,r=this.layers[0].getScale();for(t=1,e=this.layers.length;t<e;t++)0===(i=this.layers[t]).parallaxX&&0===i.parallaxY||i.getScale()<r&&(r=i.getScale());return r},t.prototype.scrollToX=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_width*(1/this.getMinLayerScale())/2;t>this.width-e&&(t=this.width-e),t<e&&(t=e)}this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_height*(1/this.getMinLayerScale())/2;t>this.height-e&&(t=this.height-e),t<e&&(t=e)}this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,r){var s=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,n=1,a=0,o=0,h=0,l=this.runtime.draw_width,c=this.runtime.draw_height;i?(n=i.layer.getScale(),a=i.layer.getAngle(),o=i.layer.viewLeft,h=i.layer.viewTop,l=i.layer.viewRight,c=i.layer.viewBottom):e&&(n=e.getScale(),a=e.getAngle(),o=e.viewLeft,h=e.viewTop,l=e.viewRight,c=e.viewBottom);var u,p,d,f,g,_=this.runtime.fx_tex,y=0,m=1,v=this.runtime.draw_width,w=this.runtime.draw_height,b=v/2,x=w/2,S=e?e.rcTex:this.rcTex,T=e?e.rcTex2:this.rcTex2,C=0,E=0,A=0,P=0,R=v,B=v,k=w,O=w,I=0,F=0,L=i?i.layer.getAngle():0;if(i){for(u=0,p=s.length;u<p;u++)I+=t.getProgramBoxExtendHorizontal(s[u].shaderindex),F+=t.getProgramBoxExtendVertical(s[u].shaderindex);var M=i.bbox;if(C=e.layerToCanvas(M.left,M.top,!0,!0),A=e.layerToCanvas(M.left,M.top,!1,!0),R=e.layerToCanvas(M.right,M.bottom,!0,!0),k=e.layerToCanvas(M.right,M.bottom,!1,!0),0!==L){var D=e.layerToCanvas(M.right,M.top,!0,!0),N=e.layerToCanvas(M.right,M.top,!1,!0),j=e.layerToCanvas(M.left,M.bottom,!0,!0),U=e.layerToCanvas(M.left,M.bottom,!1,!0);d=Math.min(C,R,D,j),R=Math.max(C,R,D,j),C=d,d=Math.min(A,k,N,U),k=Math.max(A,k,N,U),A=d}C-=I,A-=F,R+=I,k+=F,T.left=C/v,T.top=1-A/w,T.right=R/v,T.bottom=1-k/w,E=C=cr.floor(C),P=A=cr.floor(A),B=R=cr.ceil(R),O=k=cr.ceil(k),C<0&&(C=0),A<0&&(A=0),R>v&&(R=v),k>w&&(k=w),(E-=I)<0&&(E=0),(P-=F)<0&&(P=0),(B+=I)>v&&(B=v),(O+=F)>w&&(O=w),S.left=C/v,S.top=1-A/w,S.right=R/v,S.bottom=1-k/w}else S.left=T.left=0,S.top=T.top=0,S.right=T.right=1,S.bottom=T.bottom=1;var W=i&&(t.programUsesDest(s[0].shaderindex)||0!==I||0!==F||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),W&&(_[y]||(_[y]=t.createEmptyTexture(v,w,this.runtime.linearSampling)),_[y].c2width===v&&_[y].c2height===w||(t.deleteTexture(_[y]),_[y]=t.createEmptyTexture(v,w,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(_[y]),f=w-P-(g=O-P),t.clearRect(E,f,B-E,g),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-b,-x),t.updateModelView(),t.quadTex(C,k,R,k,R,A,C,A,S)),T.left=T.top=0,T.right=T.bottom=1,i&&(d=S.top,S.top=S.bottom,S.bottom=d),y=1,m=0),t.setOpacity(1);var V=s.length-1,z=t.programUsesCrossSampling(s[V].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,q=0;for(u=0,p=s.length;u<p;u++){if(_[y]||(_[y]=t.createEmptyTexture(v,w,this.runtime.linearSampling)),_[y].c2width===v&&_[y].c2height===w||(t.deleteTexture(_[y]),_[y]=t.createEmptyTexture(v,w,this.runtime.linearSampling)),t.switchProgram(s[u].shaderindex),q=s[u].index,t.programIsAnimated(s[u].shaderindex)&&(this.runtime.redraw=!0),0!=u||W)t.setProgramParameters(r,1/v,1/w,T.left,T.top,T.right,T.bottom,n,a,o,h,(o+l)/2,(h+c)/2,this.runtime.kahanTime.sum,i?i.effect_params[q]:e?e.effect_params[q]:this.effect_params[q]),t.setTexture(null),u!==V||z?(t.setRenderingToTexture(_[y]),f=w-P-(g=O-P),t.clearRect(E,f,B-E,g)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(r)),t.setTexture(_[m]),t.resetModelView(),t.translate(-b,-x),t.updateModelView(),t.quadTex(C,k,R,k,R,A,C,A,S),u!==V||z||t.setTexture(null);else{if(t.setRenderingToTexture(_[y]),f=w-P-(g=O-P),t.clearRect(E,f,B-E,g),i){var X,G;if(i.curFrame&&i.curFrame.texture_img){var H=i.curFrame.texture_img;X=1/H.width,G=1/H.height}else X=1/i.width,G=1/i.height;t.setProgramParameters(r,X,G,T.left,T.top,T.right,T.bottom,n,a,o,h,(o+l)/2,(h+c)/2,this.runtime.kahanTime.sum,i.effect_params[q]),i.drawGL(t)}else t.setProgramParameters(r,1/v,1/w,0,0,1,1,n,a,o,h,(o+l)/2,(h+c)/2,this.runtime.kahanTime.sum,e?e.effect_params[q]:this.effect_params[q]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-b,-x),t.updateModelView(),t.quadTex(C,k,R,k,R,A,C,A,S);T.left=T.top=0,T.right=T.bottom=1,i&&!z&&(d=k,k=A,A=d)}m=0===(y=0===y?1:0)?1:0}z&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),b=this.runtime.width/2,x=this.runtime.height/2,C=0,A=0,R=this.runtime.width,k=this.runtime.height),t.setRenderingToTexture(r),t.setTexture(_[m]),t.resetModelView(),t.translate(-b,-x),t.updateModelView(),i&&1===s.length&&!W?t.quadTex(C,A,R,A,R,k,C,k,S):t.quadTex(C,k,R,k,R,A,C,A,S),t.setTexture(null))},t.prototype.getLayerBySid=function(t){var e,i;for(e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){var t,e,i,r,s={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};for(t=0,e=this.effect_types.length;t<e;t++)r=this.effect_types[t],s.fx.push({name:r.name,active:r.active,params:this.effect_params[r.index]});for(t=0,e=this.layers.length;t<e;t++)i=this.layers[t],s.layers[i.sid.toString()]=i.saveToJSON();return s},t.prototype.loadFromJSON=function(t){var e,i,r,s,n;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);var a=t.fx;for(e=0,i=a.length;e<i;e++)(r=this.getEffectByName(a[e].name))&&(r.active=a[e].active,this.effect_params[r.index]=a[e].params);this.updateActiveEffects();var o=t.layers;for(s in o)if(o.hasOwnProperty(s)){if(!(n=this.getLayerBySid(parseInt(s,10))))continue;n.loadFromJSON(o[s])}},cr.layout=t,n.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},n.prototype.getEffectByName=function(t){var e,i,r;for(e=0,i=this.effect_types.length;e<i;e++)if((r=this.effect_types[e]).name===t)return r;return null},n.prototype.createInitialInstances=function(){var t,i,r,s,n,a,o;for(t=0,i=0,r=this.initial_instances.length;t<r;t++){if(n=this.initial_instances[t],a=this.runtime.types_by_index[n[1]],o=!0,!this.runtime.typeHasPersistBehavior(a)||this.layout.first_visit){if(!(s=this.runtime.createInstanceFromInit(n,this,!0)))continue;e.push(s),s.type.global&&(o=!1,this.created_globals.push(s.uid))}o&&(this.initial_instances[i]=this.initial_instances[t],i++)}this.initial_instances.length=i,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},n.prototype.recreateInitialObjects=function(t,e){var i,r,s,n,a,o,h,l,c,u,p,d=this.runtime.types_by_index,f=t.is_family,g=t.members;for(i=0,r=this.initial_instances.length;i<r;++i)if(o=(a=(s=this.initial_instances[i])[0])[0],h=a[1],e.contains_pt(o,h)){if((n=d[s[1]])!==t){if(!f)continue;if(g.indexOf(n)<0)continue}if(l=this.runtime.createInstanceFromInit(s,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(n.plugin).cnds.OnCreated,l),l.is_contained)for(c=0,u=l.siblings.length;c<u;c++)p=l.siblings[i],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--}},n.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},n.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},n.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},n.prototype.moveInstanceAdjacent=function(t,e,i){var r=t.get_zindex(),s=e.get_zindex();cr.arrayRemove(this.instances,r),r<s&&s--,i&&s++,s===this.instances.length?this.instances.push(t):this.instances.splice(s,0,t),this.setZIndicesStaleFrom(r<s?r:s)},n.prototype.setZIndicesStaleFrom=function(t){(-1===this.zindices_stale_from||t<this.zindices_stale_from)&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},n.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},n.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},n.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},n.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var a=[];function o(){return a.length?a.pop():[]}function h(t){cr.clearArray(t),a.push(t)}function l(t,e,i){var r,s,n=0,a=0,o=0,h=t.length,l=e.length;for(i.length=h+l;n<h&&a<l;++o)r=t[n],s=e[a],r.zindex<s.zindex?(i[o]=r,++n):(i[o]=s,++a);for(;n<h;++n,++o)i[o]=t[n];for(;a<l;++a,++o)i[o]=e[a]}var c=[];function u(t,e){var i,r,s,n,a;for(i=0,r=t.length;i<r-1;i+=2)l(s=t[i],n=t[i+1],a=o()),e||(h(s),h(n)),c.push(a);r%2==1&&(e?(s=o(),cr.shallowAssignArray(s,t[r-1]),c.push(s)):c.push(t[r-1])),cr.shallowAssignArray(t,c),cr.clearArray(c)}var p=[];n.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,p),!p.length)return o();if(1===p.length){var t=o();return cr.shallowAssignArray(t,p[0]),cr.clearArray(p),t}var e=function(t){for(var e=!0;t.length>1;)u(t,e),e=!1;return t[0]}(p);return cr.clearArray(p),e},n.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,r=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),r=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,r=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,r=!0),r&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),n=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n)),this.rotateViewport(s,n,i);var a,o=this.getScale();i.scale(o,o),i.translate(-s,-n),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),a=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):a=this.last_render_list):a=this.instances;var l,c,u,p=null;for(l=0,c=a.length;l<c;++l)(u=a[l])!==p&&(this.drawInstance(u,i),p=u);this.useRenderCells&&(this.last_render_list=a),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},n.prototype.drawInstance=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e))}},n.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},n.prototype.rotateViewport=function(t,e,i){var r,s=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/s),this.viewBottom=e+this.runtime.draw_height*(1/s),this.viewLeft>this.viewRight&&(r=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=r),this.viewTop>this.viewBottom&&(r=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=r);var n=this.getAngle();0!==n&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-n),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,n),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},n.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var r,s=this.getScale();t.resetModelView(),t.scale(s,s),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;var n,a,o=null;for(n=r.length-1;n>=0;--n)(a=r[n])!==o&&(this.drawInstanceGL_earlyZPass(r[n],t),o=a);this.useRenderCells&&(this.last_render_list=r),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},n.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||this.active_effect_types.length>0||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),s=Math.round(s)),this.rotateViewport(r,s,null);var n,a=this.getScale();t.resetModelView(),t.scale(a,a),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;var o,l,c,u=null;for(o=0,l=n.length;o<l;++o)(c=n[o])!==u&&(this.drawInstanceGL(n[o],t),u=c);if(this.useRenderCells&&(this.last_render_list=n),this.render_offscreen)if(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity){1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,a,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView();var p=this.runtime.draw_width/2,d=this.runtime.draw_height/2;t.quad(-p,d,p,d,p,-d,-p,-d),t.setTexture(null)}else this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget())},n.prototype.drawInstanceGL=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e)))}},n.prototype.drawInstanceGL_earlyZPass=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e)))}},n.prototype.drawInstanceWithShadersGL=function(t,e){var i=t.active_effect_types[0].shaderindex,r=t.active_effect_types[0].index,s=this.getScale();if(1!==t.active_effect_types.length||e.programUsesCrossSampling(i)||e.programExtendsBox(i)||(t.angle||t.layer.getAngle())&&e.programUsesDest(i)||1!==t.opacity||t.type.plugin.must_predraw)this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(s,s),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();else{e.switchProgram(i),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(i)&&(this.runtime.redraw=!0);var n,a,o=0,h=0,l=0,c=0;if(e.programUsesDest(i)){var u=t.bbox,p=this.layerToCanvas(u.left,u.top,!0,!0),d=this.layerToCanvas(u.left,u.top,!1,!0),f=this.layerToCanvas(u.right,u.bottom,!0,!0),g=this.layerToCanvas(u.right,u.bottom,!1,!0);o=p/windowWidth,h=1-d/windowHeight,l=f/windowWidth,c=1-g/windowHeight}if(t.curFrame&&t.curFrame.texture_img){var _=t.curFrame.texture_img;n=1/_.width,a=1/_.height}else n=1/t.width,a=1/t.height;e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),n,a,o,h,l,c,s,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[r]),t.drawGL(e)}},n.prototype.canvasToLayer=function(t,e,i,r){var s=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=s,e*=s);var n=this.runtime.parallax_x_origin,a=this.runtime.parallax_y_origin,o=(this.layout.scrollX-n)*this.parallaxX+n,h=(this.layout.scrollY-a)*this.parallaxY+a,l=o,c=h,u=1/this.getScale(!r);r?(l-=this.runtime.draw_width*u/2,c-=this.runtime.draw_height*u/2):(l-=this.runtime.width*u/2,c-=this.runtime.height*u/2),l+=t*u,c+=e*u;var p=this.getAngle();if(0!==p){l-=o,c-=h;var d=Math.cos(p),f=Math.sin(p),g=l*d-c*f;c=c*d+l*f,l=g,l+=o,c+=h}return i?l:c},n.prototype.layerToCanvas=function(t,e,i,r){var s=this.runtime.parallax_x_origin,n=this.runtime.parallax_y_origin,a=(this.layout.scrollX-s)*this.parallaxX+s,o=(this.layout.scrollY-n)*this.parallaxY+n,h=a,l=o,c=this.getAngle();if(0!==c){t-=a,e-=o;var u=Math.cos(-c),p=Math.sin(-c),d=t*u-e*p;e=e*u+t*p,t=d,t+=a,e+=o}var f=1/this.getScale(!r);r?(h-=this.runtime.draw_width*f/2,l-=this.runtime.draw_height*f/2):(h-=this.runtime.width*f/2,l-=this.runtime.height*f/2),h=(t-h)/f,l=(e-l)/f;var g=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!r&&(h/=g,l/=g),i?h:l},n.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var r=this.layerToCanvas(t,e,!0),s=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var n=this.canvasToLayer(r,s,!0),a=this.canvasToLayer(r,s,!0);return this.disableAngle=!1,i?n:a},n.prototype.saveToJSON=function(){var t,e,i,r={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};for(t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],r.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});return r},n.prototype.loadFromJSON=function(t){var e,r,s,n;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var a=new cr.ObjectSet;for(e=0,s=this.created_globals.length;e<s;++e)a.add(this.created_globals[e]);for(e=0,r=0,s=this.initial_instances.length;e<s;++e)a.contains(this.initial_instances[e][2])||(this.initial_instances[r]=this.initial_instances[e],++r);cr.truncateArray(this.initial_instances,r);var o=t.fx;for(e=0,s=o.length;e<s;e++)(n=this.getEffectByName(o[e].name))&&(n.active=o[e].active,this.effect_params[n.index]=o[e].params);this.updateActiveEffects(),this.instances.sort(i),this.zindices_stale=!0},cr.layer=n}(),function(){var t=[];function e(t,e){var i,r=t.length;switch(r){case 0:return!0;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}}function i(t,e){return t.index-e.index}function r(r){var s,n,a,o,h;for(2===r.length?r[0].index>r[1].index&&(o=r[0],r[0]=r[1],r[1]=o):r.length>2&&r.sort(i),r.length>=t.length&&(t.length=r.length+1),t[r.length]||(t[r.length]=[]),s=0,n=(h=t[r.length]).length;s<n;s++)if(e(r,a=h[s]))return a;return h.push(r),r}function s(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,r,s=e[1];for(this.events=[],i=0,r=s.length;i<r;i++)this.init_event(s[i],null,this.events)}function n(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function a(t,e,i){var r,s;this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var n=i[5];for(r=0,s=n.length;r<s;r++){var a=new cr.condition(this,n[r]);a.index=r,cr.seal(a),this.conditions.push(a),this.addSolModifier(a.type)}var o=i[6];for(r=0,s=o.length;r<s;r++){var h=new cr.action(this,o[r]);h.index=r,cr.seal(h),this.actions.push(h)}if(8===i.length){var l=i[7];for(r=0,s=l.length;r<s;r++)this.sheet.init_event(l[r],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function o(t,e){var i,r,s;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,r=t.container.length;i<r;i++)t!==(s=t.container[i])&&-1===e.indexOf(s)&&e.push(s)}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=e[3]>0,this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){var i,r,s=e[9];for(i=0,r=s.length;i<r;i++){var n=new cr.parameter(this,s[i]);cr.seal(n),this.parameters.push(n)}this.results.length=s.length}}function l(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){var i,r,s=e[5];for(i=0,r=s.length;i<r;i++){var n=new cr.parameter(this,s[i]);cr.seal(n),this.parameters.push(n)}this.results.length=s.length}}s.prototype.toString=function(){return this.name},s.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var r,s,n=new cr.eventblock(this,e,t);if(cr.seal(n),n.orblock)for(i.push(n),r=0,s=n.conditions.length;r<s;r++)n.conditions[r].trigger&&this.init_trigger(n,r);else n.is_trigger()?this.init_trigger(n,0):i.push(n);break;case 1:var a=new cr.eventvariable(this,e,t);cr.seal(a),i.push(a);break;case 2:var o=new cr.eventinclude(this,e,t);cr.seal(o),i.push(o)}},s.prototype.postInit=function(){var t,e;for(t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},s.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},s.prototype.addDeepIncludes=function(t){var e,i,r,s,n=t.deep_includes,a=t.already_included_sheets,o=this.includes.valuesRef();for(e=0,i=o.length;e<i;++e)s=(r=o[e]).include_sheet,!r.isActive()||t===s||a.indexOf(s)>-1||(a.push(s),s.addDeepIncludes(t),n.push(s))},s.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var r=this.events[e];r.run(),this.runtime.clearSol(r.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},s.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i,r=t.conditions[e];i=r.type?r.type.name:"system";var s=r.fasttrigger,n=s?this.fasttriggers:this.triggers;n[i]||(n[i]=[]);var a=n[i],o=r.func;if(s){if(!r.parameters.length)return;var h,l=r.parameters[0];if(1!==l.type||2!==l.expression.type)return;var c,u,p=l.expression.value.toLowerCase();for(c=0,u=a.length;c<u;c++)if(a[c].method==o)return void((h=a[c].evs)[p]?h[p].push([t,e]):h[p]=[[t,e]]);(h={})[p]=[[t,e]],a.push({method:o,evs:h})}else{for(c=0,u=a.length;c<u;c++)if(a[c].method==o)return void a[c].evs.push([t,e]);!function(t){return!(!cr.plugins_.Sprite||t!==cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}(o)?a.push({method:o,evs:[[t,e]]}):a.unshift({method:o,evs:[[t,e]]})}},cr.eventsheet=s,n.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},n.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},n.prototype.pick_one=function(t){if(t)if(t.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1);var e=this.else_instances.indexOf(t);-1!==e&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t},cr.selection=n,window._c2hh_="25393FB06DF78920331A8DB6FB7175B2B6E939D5",a.prototype.postInit=function(t){var e,i,s=this.parent;if(this.group)for(this.toplevelgroup=!0;s;){if(!s.group){this.toplevelgroup=!1;break}s=s.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),s=this.parent;s;){for(e=0,i=s.solModifiers.length;e<i;e++)this.addParentSolModifier(s.solModifiers[e]);s=s.parent}for(this.solModifiers=r(this.solModifiers),this.solModifiersIncludingParents=r(this.solModifiersIncludingParents),e=0,i=this.conditions.length;e<i;e++)this.conditions[e].postInit();for(e=0,i=this.actions.length;e<i;e++)this.actions[e].postInit();for(e=0,i=this.subevents.length;e<i;e++)this.subevents[e].postInit(e<i-1&&this.subevents[e+1].is_else_block)},a.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();i>0&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},a.prototype.addSolModifier=function(t){o(t,this.solModifiers)},a.prototype.addParentSolModifier=function(t){o(t,this.solModifiersIncludingParents)},a.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},a.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},a.prototype.run=function(){var t,e,i=!1,r=this.runtime,s=this.runtime.getCurrentEventStack();s.current_event=this;var n=this.conditions;if(this.is_else_block||(s.else_branch_ran=!1),this.orblock){for(0===n.length&&(i=!0),s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)(e=n[s.cndindex]).trigger||e.run()&&(i=!0);s.last_event_true=i,i&&this.run_actions_and_subevents()}else{for(s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)if(!n[s.cndindex].run())return s.last_event_true=!1,void(this.toplevelevent&&r.hasPendingInstances&&r.ClearDeathRow());s.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(s)},a.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},a.prototype.run_orblocktrigger=function(t){this.runtime.getCurrentEventStack().current_event=this,this.conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},a.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},a.prototype.resume_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},a.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,r,s=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(r=!this.toplevelgroup||!this.group&&t<s)&&this.runtime.pushCopySol(i.solModifiers),i.run(),r?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},a.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},a.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},a.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;e>=0;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=a,h.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_true=function(){return!0},h.prototype.run_system=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},h.prototype.run_static=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},h.prototype.run_object=function(){var t,e,i,r,s,n,a,o,h,l,c,u,p=this.type,d=p.getCurrentSol(),f=this.block.orblock&&!this.trigger,g=0,_=p.is_contained,y=p.is_family,m=p.family_index,v=this.beh_index,w=v>-1,b=this.anyParamVariesPerInstance,x=this.parameters,S=this.results,T=this.inverted,C=this.func;if(b)for(e=0,s=x.length;e<s;++e)(n=x[e]).variesPerInstance||(S[e]=n.get(0));else for(e=0,s=x.length;e<s;++e)S[e]=x[e].get(0);if(d.select_all){for(cr.clearArray(d.instances),cr.clearArray(d.else_instances),t=0,r=(c=p.instances).length;t<r;++t){if(o=c[t],b)for(e=0,s=x.length;e<s;++e)(n=x[e]).variesPerInstance&&(S[e]=n.get(t));w?(g=0,y&&(g=o.type.family_beh_map[m]),a=C.apply(o.behavior_insts[v+g],S)):a=C.apply(o,S),cr.xor(a,T)?d.instances.push(o):f&&d.else_instances.push(o)}return p.finish&&p.finish(!0),d.select_all=!1,p.applySolToContainer(),d.hasObjects()}i=0;var E=f&&!this.block.isFirstConditionOfType(this),A=!1;for(t=0,r=(c=E?d.else_instances:d.instances).length;t<r;++t){if(o=c[t],b)for(e=0,s=x.length;e<s;++e)(n=x[e]).variesPerInstance&&(S[e]=n.get(t));if(w?(g=0,y&&(g=o.type.family_beh_map[m]),a=C.apply(o.behavior_insts[v+g],S)):a=C.apply(o,S),cr.xor(a,T))if(A=!0,E){if(d.instances.push(o),_)for(e=0,s=o.siblings.length;e<s;e++)(h=o.siblings[e]).type.getCurrentSol().instances.push(h)}else{if(c[i]=o,_)for(e=0,s=o.siblings.length;e<s;e++)(h=o.siblings[e]).type.getCurrentSol().instances[i]=h;i++}else if(E){if(c[i]=o,_)for(e=0,s=o.siblings.length;e<s;e++)(h=o.siblings[e]).type.getCurrentSol().else_instances[i]=h;i++}else if(f&&(d.else_instances.push(o),_))for(e=0,s=o.siblings.length;e<s;e++)(h=o.siblings[e]).type.getCurrentSol().else_instances.push(h)}if(cr.truncateArray(c,i),_)for(t=0,r=(u=p.container).length;t<r;t++)l=u[t].getCurrentSol(),E?cr.truncateArray(l.else_instances,i):cr.truncateArray(l.instances,i);var P=A;if(E&&!A)for(t=0,r=d.instances.length;t<r;t++){if(o=d.instances[t],b)for(e=0,s=x.length;e<s;e++)(n=x[e]).variesPerInstance&&(S[e]=n.get(t));if(a=w?C.apply(o.behavior_insts[v],S):C.apply(o,S),cr.xor(a,T)){A=!0;break}}return p.finish&&p.finish(P||f),f?A:d.hasObjects()},cr.condition=h,l.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},l.prototype.run_system=function(){var t,e,i=this.runtime,r=this.parameters,s=this.results;for(t=0,e=r.length;t<e;++t)s[t]=r[t].get();return this.func.apply(i.system,s)},l.prototype.run_object=function(){var t,e,i,r,s,n,a,o=this.type,h=this.beh_index,l=o.family_index,c=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,f=o.getCurrentSol().getObjects(),g=o.is_family,_=h>-1;if(c)for(e=0,r=u.length;e<r;++e)(s=u[e]).variesPerInstance||(p[e]=s.get(0));else for(e=0,r=u.length;e<r;++e)p[e]=u[e].get(0);for(t=0,i=f.length;t<i;++t){if(n=f[t],c)for(e=0,r=u.length;e<r;++e)(s=u[e]).variesPerInstance&&(p[e]=s.get(t));_?(a=0,g&&(a=n.type.family_beh_map[l]),d.apply(n.behavior_insts[h+a],p)):d.apply(n,p)}return!1},cr.action=l;var c=[],u=-1;function p(){return u++,c.length===u&&c.push(new cr.expvalue),c[u]}function d(){u--}function f(t,e){var i,r,s;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,r=e.length;i<r;i++)s=new cr.parameter(this.owner,e[i]),cr.seal(s),this.subparams.push(s),this.variadicret.push(0)}}function g(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function _(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function y(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}f.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},f.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},f.prototype.setVaries=function(){this.variesPerInstance=!0},f.prototype.get_exp=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.data},f.prototype.get_exp_str=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),cr.is_string(e.data)?e.data:""},f.prototype.get_object=function(){return this.object},f.prototype.get_combosel=function(){return this.combosel},f.prototype.get_layer=function(t){this.solindex=t||0;var e=p();return this.expression.get(e),d(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},f.prototype.get_layout=function(){return this.layout},f.prototype.get_key=function(){return this.key},f.prototype.get_instvar=function(){return this.index},f.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,r=null,s=i.getCurrentSol(),n=s.getObjects();if(n.length)r=n[e%n.length].type;else if(s.else_instances.length)r=s.else_instances[e%s.else_instances.length].type;else{if(!i.instances.length)return 0;r=i.instances[e%i.instances.length].type}return this.index+r.family_var_map[i.family_index]},f.prototype.get_eventvar=function(){return this.eventvar},f.prototype.get_audiofile=function(){return this.fileinfo},f.prototype.get_variadic=function(){var t,e;for(t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=f,g.prototype.postInit=function(){this.solModifiers=r(this.solModifiers)},g.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},g.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length||void 0===t[this.localIndex]?this.initial:t[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g,_.prototype.toString=function(){return"include:"+this.include_sheet.toString()},_.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=r(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},_.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},_.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},_.prototype.isActive=function(){return this.active},cr.eventinclude=_,y.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},y.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=y}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i,r,s=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(s=e[2],this.results.length=s.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(s=e[5],this.results.length=s.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(s=e[6],this.results.length=s.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),this.type>=4&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),s)for(i=0,r=s.length;i<r;i++)this.parameters.push(new cr.expNode(t,s[i]));cr.seal(this)}t.prototype.postInit=function(){var t,e;if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function r(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function s(){--i}function n(t,e,i){var r,s;for(r=0,s=t.length;r<s;++r)t[r].get(i),e[r+1]=i.data}function a(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,n(e,i,r()),s(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,a=this.parameters,o=this.instance_expr,h=this.func,l=this.owner.solindex,c=e.getCurrentSol(),u=c.getObjects();if(!u.length){if(!c.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));u=c.else_instances}i[0]=t,t.object_class=e;var p=r();n(a,i,p),o&&(o.get(p),p.is_number()&&(l=p.data,u=e.instances)),s();var d=u.length;(l>=d||l<=-d)&&(l%=d),l<0&&(l+=d);h.apply(u[l],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,a=this.parameters,o=this.instance_expr,h=this.beh_index,l=this.func,c=this.owner.solindex,u=e.getCurrentSol(),p=u.getObjects();if(!p.length){if(!u.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));p=u.else_instances}i[0]=t,t.object_class=e;var d=r();n(a,i,d),o&&(o.get(d),d.is_number()&&(c=d.data,p=e.instances)),s();var f=p.length;(c>=f||c<=-f)&&(c%=f),c<0&&(c+=f);var g=p[c],_=0;e.is_family&&(_=g.type.family_beh_map[e.family_index]);l.apply(g.behavior_insts[h+_],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,n=this.object_type,a=this.varindex,o=this.owner.solindex,h=n.getCurrentSol(),l=h.getObjects();if(!l.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));l=h.else_instances}if(i){var c=r();if(i.get(c),c.is_number()){o=c.data;var u=n.instances;0!==u.length&&(o%=u.length)<0&&(o+=u.length);var p=(e=n.getInstanceByIID(o)).instance_vars[a];return cr.is_string(p)?t.set_string(p):t.set_float(p),void s()}s()}var d=l.length;(o>=d||o<=-d)&&(o%=d),o<0&&(o+=d),e=l[o];var f=0;n.is_family&&(f=e.type.family_var_map[n.family_index]);p=e.instance_vars[a+f];cr.is_string(p)?t.set_string(p):t.set_float(p)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_divide=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),s()},t.prototype.eval_mod=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_power=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),s()},t.prototype.eval_and=function(t){this.first.get(t);var e=r();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),s()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=r();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),s()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data===e.data?1:0),s()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data!==e.data?1:0),s()},t.prototype.eval_less=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data<e.data?1:0),s()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data<=e.data?1:0),s()},t.prototype.eval_greater=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data>e.data?1:0),s()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=r();this.second.get(e),t.set_int(t.data>=e.data?1:0),s()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,a.prototype.is_int=function(){return this.type===cr.exptype.Integer},a.prototype.is_float=function(){return this.type===cr.exptype.Float},a.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},a.prototype.is_string=function(){return this.type===cr.exptype.String},a.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},a.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},a.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},a.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},a.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},a.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},a.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=a,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var t,e,i,r,s,n,a,o,h={};h.waits=[];var l,c=h.waits;for(t=0,e=this.waits.length;t<e;t++){for(l={t:(n=this.waits[t]).time,st:n.signaltag,s:n.signalled,ev:n.ev.sid,sm:[],sols:{}},n.ev.actions[n.actindex]&&(l.act=n.ev.actions[n.actindex].sid),i=0,r=n.solModifiers.length;i<r;i++)l.sm.push(n.solModifiers[i].sid);for(s in n.sols)if(n.sols.hasOwnProperty(s)){for(a=this.runtime.types_by_index[parseInt(s,10)],o={sa:n.sols[s].sa,insts:[]},i=0,r=n.sols[s].insts.length;i<r;i++)o.insts.push(n.sols[s].insts[i].uid);l.sols[a.sid.toString()]=o}c.push(l)}return h},cr.system_object.prototype.loadFromJSON=function(t){var e,i,r,s,n,a,o,h,l,c,u,p,d,f=t.waits;for(cr.clearArray(this.waits),e=0,i=f.length;e<i;e++)if(a=f[e],h=this.runtime.blocksBySid[a.ev.toString()]){for(l=-1,r=0,s=h.actions.length;r<s;r++)if(h.actions[r].sid===a.act){l=r;break}if(-1!==l){for((o={}).sols={},o.solModifiers=[],o.deleteme=!1,o.time=a.t,o.signaltag=a.st||"",o.signalled=!!a.s,o.ev=h,o.actindex=l,r=0,s=a.sm.length;r<s;r++)(c=this.runtime.getObjectTypeBySid(a.sm[r]))&&o.solModifiers.push(c);for(n in a.sols)if(a.sols.hasOwnProperty(n)){if(!(c=this.runtime.getObjectTypeBySid(parseInt(n,10))))continue;for(p={sa:(u=a.sols[n]).sa,insts:[]},r=0,s=u.insts.length;r<s;r++)(d=this.runtime.getObjectByUID(u.insts[r]))&&p.insts.push(d);o.sols[c.index.toString()]=p}this.waits.push(o)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0===t){var r=this.runtime.getCurrentCondition();return!r.extra.CompareTime_executed&&i>=e&&(r.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(i,t,e)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;e<t&&!n.stopped;e++)this.runtime.pushCopySol(r.solModifiers),n.index=e,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(e=0;e<t&&!n.stopped;e++)n.index=e,r.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;!n.stopped;e++)this.runtime.pushCopySol(r.solModifiers),n.index=e,r.retrigger()||(n.stopped=!0),this.runtime.popSol(r.solModifiers);else for(e=0;!n.stopped;e++)n.index=e,r.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var r,s=this.runtime.getCurrentEventStack(),n=s.current_event,a=s.isModifierAfterCnds(),o=this.runtime.pushLoopStack(t);if(i<e)if(a)for(r=e;r>=i&&!o.stopped;--r)this.runtime.pushCopySol(n.solModifiers),o.index=r,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(r=e;r>=i&&!o.stopped;--r)o.index=r,n.retrigger();else if(a)for(r=e;r<=i&&!o.stopped;++r)this.runtime.pushCopySol(n.solModifiers),o.index=r,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(r=e;r<=i&&!o.stopped;++r)o.index=r,n.retrigger();return this.runtime.popLoopStack(),!1};var i=[],r=-1;function s(t,e){var i=t.extra.c2_feo_val,r=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(r)?i-r:(i=""+i)<(r=""+r)?-1:i>r?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();r++,i.length===r&&i.push([]);var s=i[r];cr.shallowAssignArray(s,e.getObjects());var n,a,o,h,l,c,u,p=this.runtime.getCurrentEventStack(),d=p.current_event,f=p.isModifierAfterCnds(),g=this.runtime.pushLoopStack(),_=t.is_contained;if(f)for(n=0,a=s.length;n<a&&!g.stopped;n++){if(this.runtime.pushCopySol(d.solModifiers),l=s[n],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=l,_)for(o=0,h=l.siblings.length;o<h;o++)(u=(c=l.siblings[o]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=c;g.index=n,d.retrigger(),this.runtime.popSol(d.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),n=0,a=s.length;n<a&&!g.stopped;n++){if(l=s[n],e.instances[0]=l,_)for(o=0,h=l.siblings.length;o<h;o++)(u=(c=l.siblings[o]).type.getCurrentSol()).select_all=!1,cr.clearArray(u.instances),u.instances[0]=c;g.index=n,d.retrigger()}return cr.clearArray(s),this.runtime.popLoopStack(),r--,!1},e.prototype.ForEachOrdered=function(t,e,n){var a=t.getCurrentSol();r++,i.length===r&&i.push([]);var o=i[r];cr.shallowAssignArray(o,a.getObjects());var h,l,c,u,p,d,f,g=this.runtime.getCurrentEventStack(),_=g.current_event,y=this.runtime.getCurrentCondition(),m=g.isModifierAfterCnds(),v=this.runtime.pushLoopStack();for(h=0,l=o.length;h<l;h++)o[h].extra.c2_feo_val=y.parameters[1].get(h);o.sort(s),1===n&&o.reverse();var w=t.is_contained;if(m)for(h=0,l=o.length;h<l&&!v.stopped;h++){if(this.runtime.pushCopySol(_.solModifiers),p=o[h],(a=t.getCurrentSol()).select_all=!1,cr.clearArray(a.instances),a.instances[0]=p,w)for(c=0,u=p.siblings.length;c<u;c++)(f=(d=p.siblings[c]).type.getCurrentSol()).select_all=!1,cr.clearArray(f.instances),f.instances[0]=d;v.index=h,_.retrigger(),this.runtime.popSol(_.solModifiers)}else for(a.select_all=!1,cr.clearArray(a.instances),h=0,l=o.length;h<l&&!v.stopped;h++){if(p=o[h],a.instances[0]=p,w)for(c=0,u=p.siblings.length;c<u;c++)(f=(d=p.siblings[c]).type.getCurrentSol()).select_all=!1,cr.clearArray(f.instances),f.instances[0]=d;v.index=h,_.retrigger()}return cr.clearArray(o),this.runtime.popLoopStack(),r--,!1},e.prototype.PickByComparison=function(t,e,s,n){var a,o,h,l;if(t){r++,i.length===r&&i.push([]);var c=i[r],u=t.getCurrentSol();cr.shallowAssignArray(c,u.getObjects()),u.select_all&&cr.clearArray(u.else_instances);var p=this.runtime.getCurrentCondition();for(a=0,h=0,o=c.length;a<o;a++)l=c[a],c[h]=l,e=p.parameters[1].get(a),n=p.parameters[3].get(a),cr.do_cmp(e,s,n)?h++:u.else_instances.push(l);return cr.truncateArray(c,h),u.select_all=!1,cr.shallowAssignArray(u.instances,c),cr.clearArray(c),r--,t.applySolToContainer(),!!u.instances.length}},e.prototype.PickByEvaluate=function(t,e){var s,n,a,o;if(t){r++,i.length===r&&i.push([]);var h=i[r],l=t.getCurrentSol();cr.shallowAssignArray(h,l.getObjects()),l.select_all&&cr.clearArray(l.else_instances);var c=this.runtime.getCurrentCondition();for(s=0,a=0,n=h.length;s<n;s++)o=h[s],h[a]=o,c.parameters[1].get(s)?a++:l.else_instances.push(o);return cr.truncateArray(h,a),l.select_all=!1,cr.shallowAssignArray(l.instances,h),cr.clearArray(h),r--,t.applySolToContainer(),!!l.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,r=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var s=e.extra.Every_seconds;return r>=i+s?(e.extra.Every_lastTime=i+s,r>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=r),e.extra.Every_seconds=t,!0):(r<i-.1&&(e.extra.Every_lastTime=r),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),r=i.getObjects();if((e=cr.floor(e))<0||e>=r.length)return!1;var s=r[e];return i.pick_one(s),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),r=cr.floor(Math.random()*i.length);if(r>=i.length)return!1;var s=i[r];return e.pick_one(s),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return t>=e&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var n=null,a="",o="";function h(t,e){return n&&t===a&&e===o||(n=new RegExp(t,e),a=t,o=e),n.lastIndex=0,n}e.prototype.RegexTest=function(t,e,i){return h(e,i).test(t)};var l=[];function c(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var r,s,n,a=t.getCurrentSol(),o=a.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,c=this.runtime.getCurrentCondition();for(a.select_all?(cr.shallowAssignArray(l,o),cr.clearArray(a.else_instances),a.select_all=!1,cr.clearArray(a.instances)):h?(cr.shallowAssignArray(l,a.else_instances),cr.clearArray(a.else_instances)):(cr.shallowAssignArray(l,o),cr.clearArray(a.instances)),r=0,s=l.length;r<s;++r)(n=l[r]).update_bbox(),cr.xor(n.contains_pt(e,i),c.inverted)?a.instances.push(n):a.else_instances.push(n);return t.applySolToContainer(),cr.xor(!!a.instances.length,c.inverted)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){var r=cr.to_clamped_radians(t),s=cr.to_clamped_radians(e),n=cr.to_clamped_radians(i);return!cr.angleClockwise(n,s)?!(!cr.angleClockwise(r,s)&&cr.angleClockwise(r,n)):cr.angleClockwise(r,s)&&!cr.angleClockwise(r,n)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,c.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},c.prototype.NextPrevLayout=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout){var e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if((!t||0!==e)&&(t||e!==this.runtime.layouts_by_index.length-1)){var i=this.runtime.layouts_by_index[e+(t?-1:1)];this.runtime.changelayout=i}}},c.prototype.CreateObject=function(t,e,i,r){if(e&&t){var s=this.runtime.createInstance(t,e,i,r);if(s){var n,a,o;if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,s),s.is_contained)for(n=0,a=s.siblings.length;n<a;n++)o=s.siblings[n],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=s,s.is_contained)for(n=0,a=s.siblings.length;n<a;n++)(h=(o=s.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=o}}},c.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},c.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},c.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},c.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},c.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},c.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},c.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},c.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},c.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},c.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},c.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},c.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},c.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},c.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},c.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t){var r,s,n=t.getCurrentSol().getObjects();for(r=0,s=n.length;r<s;r++)n[r].my_timescale=i}},c.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;var e,i,r=t.getCurrentSol().getObjects();for(e=0,i=r.length;e<i;e++)r[e].my_timescale=-1};var u=[];function p(){var t;return u.length?t=u.pop():((t={}).sols={},t.solModifiers=[]),t.deleteme=!1,t}function d(t){cr.wipe(t.sols),cr.clearArray(t.solModifiers),u.push(t)}var f=[];function g(){var t;return f.length?t=f.pop():(t={}).insts=[],t.sa=!1,t}function _(t){cr.clearArray(t.insts),f.push(t)}function y(t,e){var i=t[0]-e[0];return 0!==i?i:t[1]-e[1]}function m(t,e){return t[1]-e[1]}function v(){}c.prototype.Wait=function(t){if(!(t<0)){var e,i,r,s,n,a=this.runtime.getCurrentEventStack(),o=p();for(o.time=this.runtime.kahanTime.sum+t,o.signaltag="",o.signalled=!1,o.ev=a.current_event,o.actindex=a.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===a.current_event.solModifiers.indexOf(s)||(o.solModifiers.push(s),(n=g()).sa=r.select_all,cr.shallowAssignArray(n.insts,r.instances),o.sols[e.toString()]=n);return this.waits.push(o),!0}},c.prototype.WaitForSignal=function(t){var e,i,r,s,n,a=this.runtime.getCurrentEventStack(),o=p();for(o.time=-1,o.signaltag=t.toLowerCase(),o.signalled=!1,o.ev=a.current_event,o.actindex=a.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===a.current_event.solModifiers.indexOf(s)||(o.solModifiers.push(s),(n=g()).sa=r.select_all,cr.shallowAssignArray(n.insts,r.instances),o.sols[e.toString()]=n);return this.waits.push(o),!0},c.prototype.Signal=function(t){var e,i,r,s=t.toLowerCase();for(e=0,i=this.waits.length;e<i;++e)-1===(r=this.waits[e]).time&&r.signaltag===s&&(r.signalled=!0)},c.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},c.prototype.ResetGlobals=function(){var t,e,i;for(t=0,e=this.runtime.all_global_vars.length;t<e;t++)(i=this.runtime.all_global_vars[t]).data=i.initial},c.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},c.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},c.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY){var r,s,n=t.instances;for(r=0,s=n.length;r<s;++r)n[r].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},c.prototype.SetLayerBackground=function(t,e){if(t){var i=cr.GetRValue(e),r=cr.GetGValue(e),s=cr.GetBValue(e);t.background_color[0]===i&&t.background_color[1]===r&&t.background_color[2]===s||(t.background_color[0]=i,t.background_color[1]=r,t.background_color[2]=s,this.runtime.redraw=!0)}},c.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},c.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},c.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},c.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},c.prototype.RestartLayout=function(t){var e,i,r;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(r=this.runtime.allGroups[e]).setGroupActive(r.initially_activated)},c.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},c.prototype.SetCanvasSize=function(t,e){if(!(t<=0||e<=0)){var i=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen)&&this.runtime.fullscreen_scaling>0&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},c.prototype.SetLayoutEffectEnabled=function(t,e){if(this.runtime.running_layout&&this.runtime.glwrap){var i=this.runtime.running_layout.getEffectByName(e);if(i){var r=1===t;i.active!=r&&(i.active=r,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},c.prototype.SetLayerEffectEnabled=function(t,e,i){if(t&&this.runtime.glwrap){var r=t.getEffectByName(i);if(r){var s=1===e;r.active!=s&&(r.active=s,t.updateActiveEffects(),this.runtime.redraw=!0)}}},c.prototype.SetLayoutEffectParam=function(t,e,i){if(this.runtime.running_layout&&this.runtime.glwrap){var r=this.runtime.running_layout.getEffectByName(t);if(r){var s=this.runtime.running_layout.effect_params[r.index];(e=Math.floor(e))<0||e>=s.length||(1===this.runtime.glwrap.getProgramParameterType(r.shaderindex,e)&&(i/=100),s[e]!==i&&(s[e]=i,r.active&&(this.runtime.redraw=!0)))}}},c.prototype.SetLayerEffectParam=function(t,e,i,r){if(t&&this.runtime.glwrap){var s=t.getEffectByName(e);if(s){var n=t.effect_params[s.index];(i=Math.floor(i))<0||i>=n.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,i)&&(r/=100),n[i]!==r&&(n[i]=r,s.active&&(this.runtime.redraw=!0)))}}},c.prototype.SaveState=function(t){this.runtime.saveToSlot=t},c.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},c.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},c.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},c.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},c.prototype.ResetPersisted=function(){var t,e;for(t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},c.prototype.RecreateInitialObjects=function(t,e,i,r,s){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,r,s)},c.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},c.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),t>120&&(t=120),this.runtime.minimumFramerate=t},c.prototype.SortZOrderByInstVar=function(t,e){if(t){var i,r,s,n,a,o,h=t.getCurrentSol().getObjects(),l=[],c=[],u=this.runtime.running_layout,p=t.is_family,d=t.family_index;for(i=0,r=h.length;i<r;++i)(s=h[i]).layer&&(n=p?s.instance_vars[e+s.type.family_var_map[d]]:s.instance_vars[e],l.push([s.layer.index,s.get_zindex()]),c.push([s,n]));if(l.length)for(l.sort(y),c.sort(m),i=0,r=l.length;i<r;++i)s=c[i][0],a=u.layers[l[i][0]],o=l[i][1],a.instances[o]!==s&&(a.instances[o]=s,s.layer=a,a.setZIndicesStaleFrom(o))}},t.acts=new c,v.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},v.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},v.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},v.prototype.len=function(t,e){t.set_int(e.length||0)},v.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},v.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},v.prototype.abs=function(t,e){t.set_float(Math.abs(e))},v.prototype.round=function(t,e){t.set_int(Math.round(e))},v.prototype.floor=function(t,e){t.set_int(Math.floor(e))},v.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},v.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},v.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},v.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},v.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},v.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},v.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},v.prototype.exp=function(t,e){t.set_float(Math.exp(e))},v.prototype.ln=function(t,e){t.set_float(Math.log(e))},v.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},v.prototype.max=function(t){var e,i,r,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&s<r&&(s=r);t.set_float(s)},v.prototype.min=function(t){var e,i,r,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&s>r&&(s=r);t.set_float(s)},v.prototype.dt=function(t){t.set_float(this.runtime.dt)},v.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},v.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},v.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},v.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},v.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},v.prototype.fps=function(t){t.set_int(this.runtime.fps)},v.prototype.loopindex=function(t,e){var i,r;if(this.runtime.loop_stack.length)if(e){for(r=this.runtime.loop_stack_index;r>=0;--r)if((i=this.runtime.loop_stack[r]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},v.prototype.distance=function(t,e,i,r,s){t.set_float(cr.distanceTo(e,i,r,s))},v.prototype.angle=function(t,e,i,r,s){t.set_float(cr.to_degrees(cr.angleTo(e,i,r,s)))},v.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},v.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},v.prototype.newline=function(t){t.set_string("\n")},v.prototype.lerp=function(t,e,i,r){t.set_float(cr.lerp(e,i,r))},v.prototype.qarp=function(t,e,i,r,s){t.set_float(cr.qarp(e,i,r,s))},v.prototype.cubic=function(t,e,i,r,s,n){t.set_float(cr.cubic(e,i,r,s,n))},v.prototype.cosp=function(t,e,i,r){t.set_float(cr.cosp(e,i,r))},v.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},v.prototype.windowheight=function(t){t.set_int(this.runtime.height)},v.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},v.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},v.prototype.clamp=function(t,e,i,r){e<i?t.set_float(i):e>r?t.set_float(r):t.set_float(e)},v.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},v.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},v.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},v.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},v.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},v.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},v.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},v.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},v.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},v.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},v.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},v.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},v.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},v.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},v.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},v.prototype.mid=function(t,e,i,r){t.set_string(cr.is_string(e)?e.substr(i,r):"")},v.prototype.tokenat=function(t,e,i,r){if(cr.is_string(e)&&cr.is_string(r)){var s=e.split(r),n=cr.floor(i);n<0||n>=s.length?t.set_string(""):t.set_string(s[n])}else t.set_string("")},v.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},v.prototype.replace=function(t,e,i,r){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(r)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),r)):t.set_string(cr.is_string(e)?e:"")},v.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},v.prototype.pi=function(t){t.set_float(cr.PI)},v.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},v.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},v.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},v.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},v.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},v.prototype.rgb=function(t,e,i,r){t.set_int(cr.RGB(e,i,r))},v.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},v.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},v.prototype.anglelerp=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i);var s=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+s*r)):t.set_float(cr.to_clamped_degrees(e-s*r))},v.prototype.anglerotate=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i),r=cr.to_radians(r),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,r)))},v.prototype.zeropad=function(t,e,i){var r=e<0?"-":"";e<0&&(e=-e);for(var s=i-e.toString().length,n=0;n<s;n++)r+="0";t.set_string(r+e.toString())},v.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},v.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},v.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},v.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},v.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},v.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},v.prototype.unlerp=function(t,e,i,r){t.set_float(cr.unlerp(e,i,r))},v.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},v.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},v.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},v.prototype.canvastolayerx=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,r,!0):0)},v.prototype.canvastolayery=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,r,!1):0)},v.prototype.layertocanvasx=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,r,!0):0)},v.prototype.layertocanvasy=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,r,!1):0)},v.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},v.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},v.prototype.regexsearch=function(t,e,i,r){var s=h(i,r);t.set_int(e?e.search(s):-1)},v.prototype.regexreplace=function(t,e,i,r,s){var n=h(i,r);t.set_string(e?e.replace(n,s):"")};var w=[],b="",x="",S="";function T(t,e,i){if(t!==b||e!==x||i!==S){var r=h(e,i);w=t.match(r),b=t,x=e,S=i}}v.prototype.regexmatchcount=function(t,e,i,r){h(i,r);T(e.toString(),i,r),t.set_int(w?w.length:0)},v.prototype.regexmatchat=function(t,e,i,r,s){s=Math.floor(s);h(i,r);T(e.toString(),i,r),!w||s<0||s>=w.length?t.set_string(""):t.set_string(w[s])},v.prototype.infinity=function(t){t.set_float(1/0)},v.prototype.setbit=function(t,e,i,r){e|=0,i|=0,r=0!==r?1:0,t.set_int(e&~(1<<i)|r<<i)},v.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},v.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},v.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},v.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new v,t.runWaits=function(){var t,e,i,r,s,n,a,o=this.runtime.getCurrentEventStack();for(t=0,i=this.waits.length;t<i;t++){if(-1===(r=this.waits[t]).time){if(!r.signalled)continue}else if(r.time>this.runtime.kahanTime.sum)continue;for(s in o.current_event=r.ev,o.actindex=r.actindex,o.cndindex=0,r.sols)r.sols.hasOwnProperty(s)&&(n=this.runtime.types_by_index[parseInt(s,10)].getCurrentSol(),a=r.sols[s],n.select_all=a.sa,cr.shallowAssignArray(n.instances,a.insts),_(a));r.ev.resume_actions_and_subevents(),this.runtime.clearSol(r.solModifiers),r.deleteme=!0}for(t=0,e=0,i=this.waits.length;t<i;t++)r=this.waits[t],this.waits[e]=r,r.deleteme?d(r):e++;cr.truncateArray(this.waits,e)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],r=t[3],s=t[4],n=t[5],a=t[6],o=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var l=e.cnds,c=e.acts,u=e.exps;r&&(l.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},l.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},l.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},l.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},l.PickDistance=function(t,e,i){var r=this.getCurrentSol(),s=r.getObjects();if(!s.length)return!1;var n,a,o,h=s[0],l=h,c=cr.distanceTo(h.x,h.y,e,i);for(n=1,a=s.length;n<a;n++)h=s[n],o=cr.distanceTo(h.x,h.y,e,i),(0===t&&o<c||1===t&&o>c)&&(c=o,l=h);return r.pick_one(l),!0},c.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},c.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},c.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},c.SetPosToObject=function(t,e){var i,r,s=t.getPairedInstance(this);s&&(s.getImagePoint?(i=s.getImagePoint(e,!0),r=s.getImagePoint(e,!1)):(i=s.x,r=s.y),this.x===i&&this.y===r||(this.x=i,this.y=r,this.set_bbox_changed()))},c.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},c.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},u.X=function(t){t.set_float(this.x)},u.Y=function(t){t.set_float(this.y)},u.dt=function(t){t.set_float(this.runtime.getDt(this))}),s&&(l.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},l.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},c.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},c.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},c.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},u.Width=function(t){t.set_float(this.width)},u.Height=function(t){t.set_float(this.height)},u.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},u.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},u.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},u.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),n&&(l.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},l.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},l.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),r=cr.to_clamped_radians(e),s=cr.clamp_angle(this.angle);return!cr.angleClockwise(r,i)?!(!cr.angleClockwise(s,i)&&cr.angleClockwise(s,r)):cr.angleClockwise(s,i)&&!cr.angleClockwise(s,r)},c.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},c.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},c.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},c.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},c.RotateTowardPosition=function(t,e,i){var r=e-this.x,s=i-this.y,n=Math.atan2(s,r),a=cr.angleRotate(this.angle,n,cr.to_radians(t));isNaN(a)||this.angle!==a&&(this.angle=a,this.set_bbox_changed())},c.SetTowardPosition=function(t,e){var i=t-this.x,r=e-this.y,s=Math.atan2(r,i);isNaN(s)||this.angle!==s&&(this.angle=s,this.set_bbox_changed())},u.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(l.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},l.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},l.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),r=i.getObjects();if(!r.length)return!1;var s,n,a,o=r[0],h=o,l=o.instance_vars[e];for(s=1,n=r.length;s<n;s++)a=(o=r[s]).instance_vars[e],(0===t&&a<l||1===t&&a>l)&&(l=a,h=o);return i.pick_one(h),!0},l.PickByUID=function(t){var e,i,r,s,n,a,o;if(this.runtime.getCurrentCondition().inverted){if((o=this.getCurrentSol()).select_all){for(o.select_all=!1,cr.clearArray(o.instances),cr.clearArray(o.else_instances),e=0,i=(a=this.instances).length;e<i;e++)(s=a[e]).uid===t?o.else_instances.push(s):o.instances.push(s);return this.applySolToContainer(),!!o.instances.length}for(e=0,r=0,i=o.instances.length;e<i;e++)s=o.instances[e],o.instances[r]=s,s.uid===t?o.else_instances.push(s):r++;return cr.truncateArray(o.instances,r),this.applySolToContainer(),!!o.instances.length}if(!(s=this.runtime.getObjectByUID(t)))return!1;if(!(o=this.getCurrentSol()).select_all&&-1===o.instances.indexOf(s))return!1;if(this.is_family){for(e=0,i=(n=s.type.families).length;e<i;e++)if(n[e]===this)return o.pick_one(s),this.applySolToContainer(),!0}else if(s.type===this)return o.pick_one(s),this.applySolToContainer(),!0;return!1},l.OnCreated=function(){return!0},l.OnDestroyed=function(){return!0},c.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},c.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},c.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},c.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},c.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},c.Destroy=function(){this.runtime.DestroyInstance(this)},c.LoadFromJsonString||(c.LoadFromJsonString=function(t){var e,i,r,s;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,r=this.behavior_insts.length;i<r;++i)(s=this.behavior_insts[i]).afterLoad&&s.afterLoad()}),u.Count=function(t){var e,i,r,s=t.object_class.instances.length;for(e=0,i=this.runtime.createRow.length;e<i;e++)r=this.runtime.createRow[e],t.object_class.is_family?r.type.families.indexOf(t.object_class)>=0&&s++:r.type===t.object_class&&s++;t.set_int(s)},u.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},u.UID=function(t){t.set_int(this.uid)},u.IID=function(t){t.set_int(this.get_iid())},u.AsJSON||(u.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),a&&(l.IsVisible=function(){return this.visible},c.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},l.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},c.SetOpacity=function(t){var e=t/100;e<0?e=0:e>1&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},u.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),o&&(l.IsOnLayer=function(t){return!!t&&this.layer===t},l.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;var r,s,n=i[0],a=n;for(r=1,s=i.length;r<s;r++)n=i[r],0===t?(n.layer.index>a.layer.index||n.layer.index===a.layer.index&&n.get_zindex()>a.get_zindex())&&(a=n):(n.layer.index<a.layer.index||n.layer.index===a.layer.index&&n.get_zindex()<a.get_zindex())&&(a=n);return e.pick_one(a),!0},c.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},c.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},c.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=t,t.appendToInstanceList(this,!0),this.runtime.redraw=!0)},c.ZMoveToObject=function(t,e){var i=0===t;if(e){var r=e.getFirstPicked(this);r&&r.uid!==this.uid&&(this.layer.index!==r.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=r.layer,r.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,r,i),this.runtime.redraw=!0)}},u.LayerNumber=function(t){t.set_int(this.layer.number)},u.LayerName=function(t){t.set_string(this.layer.name)},u.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(c.SetEffectEnabled=function(t,e){if(this.runtime.glwrap){var i=this.type.getEffectIndexByName(e);if(!(i<0)){var r=1===t;this.active_effect_flags[i]!==r&&(this.active_effect_flags[i]=r,this.updateActiveEffects(),this.runtime.redraw=!0)}}},c.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var r=this.type.getEffectIndexByName(t);if(!(r<0)){var s=this.type.effect_types[r],n=this.effect_params[r];(e=Math.floor(e))<0||e>=n.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,e)&&(i/=100),n[e]!==i&&(n[e]=i,s.active&&(this.runtime.redraw=!0)))}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var t,e,i=this.bbox_changed_callbacks;for(t=0,e=i.length;t<e;++t)i[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){if(this.bbox_changed){var t=this.bbox,e=this.bquad;t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var t=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var e=this.layer.render_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.rendercells.equals(t)||(this.rendercells.right<this.rendercells.left?e.update(this,null,t):e.update(this,this.rendercells,t),this.rendercells.copy(t),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var e=this.type.collision_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.collcells.equals(t)||(this.collcells.right<this.collcells.left?e.update(this,null,t):e.update(this,this.collcells,t),this.collcells.copy(t),this.cell_changed=!1)}},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t,e,i;cr.clearArray(this.active_effect_types);var r=!0;for(t=0,e=this.active_effect_flags.length;t<e;t++)this.active_effect_flags[t]&&(i=this.type.effect_types[t],this.active_effect_types.push(i),i.preservesOpaqueness||(r=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=r},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){var e,i,r;if(t&&t.is_contained&&t.type!=this)for(e=0,i=t.siblings.length;e<i;e++)if((r=t.siblings[e]).type==this)return r;var s=this.getCurrentSol().getObjects();return s.length?s[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var t,e;for(t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,r=this.runtime.createRow;for(t=0,e=r.length;t<e;++t)r[t].type===this&&(r[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;var e,i,r=this.runtime.createRow;for(e=0,i=r.length;e<i;++e)if(r[e].type===this){if(0===t)return r[e];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,r,s,n,a=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(r=0,s=(n=this.families[e]).behaviors.length;r<s;r++){if(t===n.behaviors[r].name)return this.extra.lastBehIndex=a,n.behaviors[r];a++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=a,this.behaviors[e];a++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){var e,i;for(e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,r,s,n,a;this.updateIIDs();var o=(n=this.getCurrentSol()).select_all,h=this.runtime.getCurrentEventStack(),l=h&&h.current_event&&h.current_event.orblock;for(t=0,e=this.container.length;t<e;t++)if((s=this.container[t])!==this&&(s.updateIIDs(),(a=s.getCurrentSol()).select_all=o,!o)){for(cr.clearArray(a.instances),i=0,r=n.instances.length;i<r;++i)a.instances[i]=s.getInstanceByIID(n.instances[i].iid);if(l)for(cr.clearArray(a.else_instances),i=0,r=n.else_instances.length;i<r;++i)a.else_instances[i]=s.getInstanceByIID(n.else_instances[i].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return t>i;case 5:return t>=i;default:return!1}}}(),cr.shaders={},cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",(function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var t=document.createElement("script");t.onload=function(){offlineScriptReady=!0,checkReady()},t.src="offlineClient.js",document.head.appendChild(t)}}));var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback((function(t){browserInstance.onSWMessage(t)}))}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var t=this;window.addEventListener("resize",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,t)})),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,t)})),window.addEventListener("offline",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,t)}))),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,t)})),document.addEventListener("backbutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)})),document.addEventListener("menubutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)})),document.addEventListener("searchbutton",(function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,t)})),document.addEventListener("tizenhwkey",(function(e){switch(e.keyName){case"back":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)||e.preventDefault()}}))),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",(function(e){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)&&(e.handled=!0)})):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(e){return!!t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),this.runtime.addSuspendCallback((function(e){e?t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,t):t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,t)})),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var t=navigator.getBattery();loadedBatteryManager=!0,t&&t.then((function(t){batteryManager=t}))}}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()},Acts.prototype.Focus=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().focus():this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().blur():this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored");else if(t>=2&&(t+=1),6===t&&(t=2),this.runtime.isNodeWebkit)this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=t>=2?t:0);else{if(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement)return;this.runtime.fullscreen_scaling=t>=2?t:0;var e=document.documentElement;firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,e.addEventListener("mozfullscreenerror",onFullscreenError),e.addEventListener("webkitfullscreenerror",onFullscreenError),e.addEventListener("MSFullscreenError",onFullscreenError),e.addEventListener("fullscreenerror",onFullscreenError)),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullScreen())}},Acts.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{var e,i,r=t.split(",");for(e=0,i=r.length;e<i;e++)r[e]=parseInt(r[e],10);navigator.vibrate?navigator.vibrate(r):navigator.mozVibrate?navigator.mozVibrate(r):navigator.webkitVibrate?navigator.webkitVibrate(r):navigator.msVibrate&&navigator.msVibrate(r)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i=document.createElement("a");if(void 0===i.download)window.open(t);else{var r=document.getElementsByTagName("body")[0];i.textContent=e,i.href=t,i.download=e,r.appendChild(i);var s=new MouseEvent("click");i.dispatchEvent(s),r.removeChild(i)}},Acts.prototype.InvokeDownloadString=function(t,e,i){var r="data:"+e+","+encodeURIComponent(t),s=document.createElement("a");if(void 0===s.download)window.open(r);else{var n=document.getElementsByTagName("body")[0];s.textContent=i,s.href=r,s.download=i,n.appendChild(s);var a=new MouseEvent("click");s.dispatchEvent(a),n.removeChild(s)}},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){if(!((t=Math.floor(t))<0||t>=orientations.length)){this.runtime.autoLockOrientation=!1;var e=orientations[t];screen.orientation&&screen.orientation.lock?screen.orientation.lock(e):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(t){t.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(t,e){if(this.runtime.isDomFree)t.set_string("");else{var i=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);i?t.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):t.set_string("")}},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result||"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.Keyboard=function(t){this.runtime=t},function(){var t=cr.plugins_.Keyboard.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.keyMap=new Array(256),this.usedKeys=new Array(256),this.triggerKey=0};var e=t.Instance.prototype;e.onCreate=function(){var t=this;this.runtime.isDomFree||(jQuery(document).keydown((function(e){t.onKeyDown(e)})),jQuery(document).keyup((function(e){t.onKeyUp(e)})))};var i=[32,33,34,35,36,37,38,39,40,44];function r(){}function s(){}e.onKeyDown=function(t){var e=!1;if(window!=window.top&&i.indexOf(t.which)>-1&&(t.preventDefault(),e=!0,t.stopPropagation()),this.keyMap[t.which])this.usedKeys[t.which]&&!e&&t.preventDefault();else{this.keyMap[t.which]=!0,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),s=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1,(r||s)&&(this.usedKeys[t.which]=!0,e||t.preventDefault())}},e.onKeyUp=function(t){this.keyMap[t.which]=!1,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1,(e||i||this.usedKeys[t.which])&&(this.usedKeys[t.which]=!0,t.preventDefault())},e.onWindowBlur=function(){var t;for(t=0;t<256;++t)if(this.keyMap[t]){this.keyMap[t]=!1,this.triggerKey=t,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);(e||i)&&(this.usedKeys[t]=!0)}},e.saveToJSON=function(){return{triggerKey:this.triggerKey}},e.loadFromJSON=function(t){this.triggerKey=t.triggerKey},r.prototype.IsKeyDown=function(t){return this.keyMap[t]},r.prototype.OnKey=function(t){return t===this.triggerKey},r.prototype.OnAnyKey=function(t){return!0},r.prototype.OnAnyKeyReleased=function(t){return!0},r.prototype.OnKeyReleased=function(t){return t===this.triggerKey},r.prototype.IsKeyCodeDown=function(t){return!((t=Math.floor(t))<0||t>=this.keyMap.length)&&this.keyMap[t]},r.prototype.OnKeyCode=function(t){return t===this.triggerKey},r.prototype.OnKeyCodeReleased=function(t){return t===this.triggerKey},t.cnds=new r,t.acts=new function(){},s.prototype.LastKeyCode=function(t){t.set_int(this.triggerKey)},s.prototype.StringFromKeyCode=function(t,e){t.set_string(function(t){switch(t=Math.floor(t)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"←";case 38:return"↑";case 39:return"→";case 40:return"↓";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(t)}}(e))},t.exps=new s}(),cr.getObjectRefTable=function(){return[cr.plugins_.Browser,cr.plugins_.Keyboard,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.Browser.prototype.acts.Alert,cr.plugins_.Browser.prototype.acts.RequestFullScreen,cr.plugins_.Browser.prototype.acts.Focus]};